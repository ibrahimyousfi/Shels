{
  "id": "session_1768935320641_78efbrpnt",
  "name": "Analysis: blog-astro-vercel",
  "timestamp": 1768935320641,
  "repoUrl": "https://github.com/ibrahimyousfi/blog-astro-vercel",
  "results": {
    "analysis": {
      "totalFiles": 21,
      "totalLines": 3670,
      "issues": [
        {
          "type": "security",
          "severity": "high",
          "file": "src/pages/api/markdown-files/[filename].ts",
          "line": 28,
          "description": "Path Traversal Vulnerability: The 'filename' parameter from the URL is used directly in path.join() without sanitization. An attacker can use '../' sequences to read or delete arbitrary files on the server.",
          "suggestion": "Sanitize the filename by removing path segments or use a whitelist. Ensure the resolved path starts with the intended MARKDOWN_DIR."
        },
        {
          "type": "security",
          "severity": "high",
          "file": "src/components/auth/LoginForm.tsx",
          "line": 7,
          "description": "Hardcoded Credentials: Admin email and password are hardcoded in the source code. This is extremely insecure and makes the system vulnerable to anyone with access to the frontend code.",
          "suggestion": "Move credentials to environment variables and validate them via a secure backend API call instead of client-side logic."
        },
        {
          "type": "security",
          "severity": "high",
          "file": "src/components/posts/PostEditor.tsx",
          "line": 144,
          "description": "Cross-Site Scripting (XSS): The post content is rendered using 'innerHTML' in the preview mode without any sanitization.",
          "suggestion": "Use a library like DOMPurify to sanitize HTML content before rendering it through innerHTML."
        },
        {
          "type": "security",
          "severity": "medium",
          "file": "src/components/auth/LoginForm.tsx",
          "line": 64,
          "description": "Insecure Authentication State: Authentication is managed purely on the client-side using localStorage/sessionStorage. This can be easily spoofed.",
          "suggestion": "Implement HttpOnly cookies for session management and verify the session on every API request."
        },
        {
          "type": "bug",
          "severity": "medium",
          "file": "src/pages/api/posts/[id].ts",
          "line": 46,
          "description": "Brittle Frontmatter Parsing: The manual line-by-line splitting of frontmatter using ':' will fail if any value (like a title) contains a colon. It also doesn't handle complex YAML structures properly.",
          "suggestion": "Use a robust YAML parser library like 'gray-matter' or 'js-yaml' to parse markdown files."
        },
        {
          "type": "quality",
          "severity": "low",
          "file": "src/utils/analytics.ts",
          "line": 4,
          "description": "Code Duplication: The 'generateSlug' function is defined in multiple files (analytics.ts, auth.ts, posts-api.ts) with slightly different implementations.",
          "suggestion": "Centralize the 'generateSlug' function into a single utility file and import it where needed."
        },
        {
          "type": "error_handling",
          "severity": "medium",
          "file": "src/pages/api/markdown-files/index.ts",
          "line": 16,
          "description": "Potential Race Condition/Directory Error: The code attempts to check and create a directory synchronously within an async API route. In high-concurrency environments, this can lead to errors.",
          "suggestion": "Initialize directory structures during the application build or startup phase rather than inside individual request handlers."
        },
        {
          "type": "performance",
          "severity": "low",
          "file": "src/utils/database.ts",
          "line": 8,
          "description": "In-memory Data Volatility: The Database class uses in-memory Maps. All data (posts, users, settings) will be lost whenever the server restarts.",
          "suggestion": "Integrate a persistent database like SQLite, PostgreSQL, or MongoDB for production use."
        },
        {
          "type": "quality",
          "severity": "low",
          "file": "src/components/AdminLayout.tsx",
          "line": 5,
          "description": "Weak Typing: Use of 'any' for the 'children' prop defeats the purpose of TypeScript.",
          "suggestion": "Use 'JSX.Element' or 'ParentProps' from solid-js for the children type definition."
        }
      ],
      "structure": {
        "mainFiles": [
          "src/pages/api/posts/index.ts",
          "src/components/posts/PostEditor.tsx",
          "src/utils/database.ts",
          "src/content/config.ts"
        ],
        "dependencies": [
          "Astro",
          "SolidJS",
          "Bootstrap 5",
          "Zod",
          "Node.js fs/path"
        ],
        "architecture": "A modern Full-stack Hybrid (SSG/SSR) architecture using Astro as the framework, SolidJS for reactive frontend components, and Astro API routes (Node.js) as a backend to interact with the local file system."
      },
      "summary": "The codebase is well-structured for a CMS prototype but contains critical security vulnerabilities. The use of hardcoded credentials and unsanitized file path inputs in API routes (Path Traversal) are the most urgent issues. Architecturally, the project suffers from logic duplication (slug generation) and brittle manual string parsing for Markdown frontmatter. While the UI uses SolidJS effectively, the lack of server-side authentication enforcement on API routes makes the current admin panel security strictly 'security by obscurity'.",
      "analysisScope": {
        "analyzedFileTypes": [
          "JavaScript",
          "TypeScript",
          "Python",
          "Java",
          "C++",
          "C#",
          "Go",
          "Rust",
          "PHP",
          "Ruby",
          "Swift",
          "Kotlin"
        ],
        "ignoredFileTypes": [
          "HTML",
          "CSS",
          "Images",
          "Config files",
          "Git files",
          "Documentation"
        ],
        "focus": "Executable code with runtime risks"
      },
      "totalRepoFiles": 85,
      "ignoredFiles": 64
    },
    "tests": {
      "unitTests": [
        {
          "name": "testGenerateSlugStandardInput",
          "type": "unit",
          "code": "import { generateSlug } from '../src/utils/analytics';\n\ndescribe('generateSlug', () => {\n  it('should convert to lowercase and replace spaces with hyphens', () => {\n    const title = 'Hello World';\n    expect(generateSlug(title)).toBe('hello-world');\n  });\n\n  it('should remove special characters', () => {\n    const title = 'Astro & SolidJS: The Future!';\n    expect(generateSlug(title)).toBe('astro-solidjs-the-future');\n  });\n\n  it('should handle multiple hyphens and trim', () => {\n    const title = '  Hello --- World  ';\n    expect(generateSlug(title)).toBe('hello-world');\n  });\n\n  it('should return empty string for non-alphanumeric input', () => {\n    expect(generateSlug('!!! ???')).toBe('');\n  });\n});",
          "description": "Tests the slug generation utility for normalization, special character removal, and whitespace handling."
        },
        {
          "name": "testSEOAnalyzerScoreCalculation",
          "type": "unit",
          "code": "import { SEOAnalyzer } from '../src/utils/analytics';\n\ndescribe('SEOAnalyzer.analyzePost', () => {\n  it('should return a score of 100 for perfect input lengths', () => {\n    const title = 'A Perfect Blog Post Title for SEO Analysis Testing'; // ~50 chars\n    const content = 'Word '.repeat(400); // 400 words\n    const meta = 'This is a meta description that falls perfectly within the recommended range of one hundred and twenty to one hundred and sixty characters for search engine optimization.';\n    \n    const result = SEOAnalyzer.analyzePost(title, content, meta);\n    expect(result.score).toBeGreaterThanOrEqual(90);\n    expect(result.issues).toHaveLength(0);\n  });\n\n  it('should penalize short titles and short content', () => {\n    const result = SEOAnalyzer.analyzePost('Short', 'Too short', 'Meta');\n    expect(result.score).toBeLessThan(50);\n    expect(result.issues).toContain('Title is too short (should be 30-60 characters)');\n    expect(result.issues).toContain('Content is too short (should be at least 300 words)');\n  });\n});",
          "description": "Validates SEO scoring logic including penalties for short titles, content, and meta descriptions."
        },
        {
          "name": "testDatabaseSingletonAndInit",
          "type": "unit",
          "code": "import { Database } from '../src/utils/database';\n\ndescribe('Database Service', () => {\n  it('should maintain a singleton instance', () => {\n    const db1 = Database.getInstance();\n    const db2 = Database.getInstance();\n    expect(db1).toBe(db2);\n  });\n\n  it('should initialize with default admin user and settings', async () => {\n    const db = Database.getInstance();\n    const admin = await db.getUserByEmail('admin@myblog.com');\n    const settings = await db.getSettings();\n    \n    expect(admin).not.toBeNull();\n    expect(admin?.role).toBe('admin');\n    expect(settings?.siteName).toBe('My Blog');\n  });\n});",
          "description": "Ensures the in-memory database follows the singleton pattern and initializes default data correctly."
        },
        {
          "name": "testRateLimiterLogic",
          "type": "unit",
          "code": "import { RateLimiter } from '../src/utils/auth';\n\ndescribe('RateLimiter', () => {\n  beforeEach(() => {\n    RateLimiter.reset('test-ip');\n  });\n\n  it('should allow requests under the limit', () => {\n    for (let i = 0; i < 5; i++) {\n      expect(RateLimiter.checkLimit('test-ip', 5)).toBe(true);\n    }\n  });\n\n  it('should block requests exceeding the limit', () => {\n    for (let i = 0; i < 5; i++) {\n      RateLimiter.checkLimit('test-ip', 5);\n    }\n    expect(RateLimiter.checkLimit('test-ip', 5)).toBe(false);\n  });\n\n  it('should reset after the window expires', async () => {\n    RateLimiter.checkLimit('test-ip', 1, 10); // 10ms window\n    await new Promise(resolve => setTimeout(resolve, 15));\n    expect(RateLimiter.checkLimit('test-ip', 1, 10)).toBe(true);\n  });\n});",
          "description": "Tests the rate limiting utility for blocking over-limit attempts and correctly handling time windows."
        },
        {
          "name": "testPasswordManagerHashing",
          "type": "unit",
          "code": "import { PasswordManager } from '../src/utils/auth';\n\ndescribe('PasswordManager', () => {\n  it('should hash and verify passwords correctly', async () => {\n    const password = 'securePassword123';\n    const hash = await PasswordManager.hashPassword(password);\n    \n    expect(hash).not.toBe(password);\n    const isValid = await PasswordManager.verifyPassword(password, hash);\n    expect(isValid).toBe(true);\n  });\n\n  it('should fail verification for incorrect passwords', async () => {\n    const hash = await PasswordManager.hashPassword('correct-pass');\n    const isValid = await PasswordManager.verifyPassword('wrong-pass', hash);\n    expect(isValid).toBe(false);\n  });\n});",
          "description": "Unit test for password security functions including base64-salt hashing simulation and verification."
        },
        {
          "name": "testMarkdownGeneratorYamlConversion",
          "type": "unit",
          "code": "import { MarkdownGenerator } from '../src/utils/markdown-generator';\n\ndescribe('MarkdownGenerator Logic', () => {\n  const generator = new MarkdownGenerator();\n\n  it('should convert objects to valid YAML strings', () => {\n    const input = {\n      title: \"Test\",\n      tags: [\"tag1\", \"tag2\"],\n      seo: { score: 100 }\n    };\n    \n    const yaml = (generator as any).objectToYaml(input);\n    expect(yaml).toContain('title: \"Test\"');\n    expect(yaml).toContain('  - \"tag1\"');\n    expect(yaml).toContain('  - \"tag2\"');\n    expect(yaml).toContain('seo:');\n    expect(yaml).toContain('  score: 100');\n  });\n\n  it('should skip undefined values', () => {\n    const yaml = (generator as any).objectToYaml({ key: 'value', secret: undefined });\n    expect(yaml).not.toContain('secret');\n  });\n});",
          "description": "Tests the recursive object-to-YAML converter used for generating Markdown frontmatter."
        },
        {
          "name": "testDashboardStatsFormatting",
          "type": "unit",
          "code": "import DashboardStats from '../src/components/dashboard/DashboardStats';\n\ndescribe('DashboardStats helper functions', () => {\n  // Manual testing of internal logic since component is default export\n  const formatNumber = (num: number): string => {\n    if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';\n    if (num >= 1000) return (num / 1000).toFixed(1) + 'K';\n    return num.toString();\n  };\n\n  it('should format large numbers correctly', () => {\n    expect(formatNumber(500)).toBe('500');\n    expect(formatNumber(1500)).toBe('1.5K');\n    expect(formatNumber(2100000)).toBe('2.1M');\n  });\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'published': return 'success';\n      case 'draft': return 'warning';\n      default: return 'secondary';\n    }\n  };\n\n  it('should map statuses to correct Bootstrap colors', () => {\n    expect(getStatusColor('published')).toBe('success');\n    expect(getStatusColor('draft')).toBe('warning');\n    expect(getStatusColor('unknown')).toBe('secondary');\n  });\n});",
          "description": "Tests the data formatting and status mapping logic used within the DashboardStats component."
        },
        {
          "name": "testPostApiFiltering",
          "type": "unit",
          "code": "import { getPosts } from '../src/utils/posts-api';\n\ndescribe('getPosts API Utility', () => {\n  it('should filter posts by search term', async () => {\n    const results = await getPosts({ search: 'حمل' });\n    results.forEach(post => {\n      const match = post.title.includes('حمل') || post.excerpt.includes('حمل');\n      expect(match).toBe(true);\n    });\n  });\n\n  it('should filter posts by status', async () => {\n    const results = await getPosts({ status: 'draft' });\n    expect(results.every(p => p.status === 'draft')).toBe(true);\n  });\n\n  it('should handle empty results gracefully', async () => {\n    const results = await getPosts({ search: 'NON_EXISTENT_CONTENT_12345' });\n    expect(results).toHaveLength(0);\n  });\n});",
          "description": "Verifies that the mock API filtering logic correctly handles search queries and status filters."
        },
        {
          "name": "testSessionManagerValidation",
          "type": "unit",
          "code": "import { SessionManager } from '../src/utils/auth';\n\ndescribe('SessionManager', () => {\n  const sm = SessionManager.getInstance();\n\n  it('should invalidate expired sessions', () => {\n    const session = sm.createSession('user1', 'agent', '127.0.0.1');\n    session.expiresAt = new Date(Date.now() - 1000); // Backdate to past\n    \n    const validated = sm.validateSession(session.token);\n    expect(validated).toBeNull();\n  });\n\n  it('should return session for valid tokens', () => {\n    const session = sm.createSession('user2', 'agent', '127.0.0.1');\n    const validated = sm.validateSession(session.token);\n    expect(validated).not.toBeNull();\n    expect(validated?.userId).toBe('user2');\n  });\n});",
          "description": "Validates the session lifecycle, including creation, token verification, and expiration logic."
        },
        {
          "name": "testBlogCardDateFormatting",
          "type": "unit",
          "code": "describe('BlogCard formatDate logic', () => {\n  const formatDate = (date: Date) => {\n    return new Intl.DateTimeFormat('en-US', {\n      year: 'numeric', month: 'long', day: 'numeric'\n    }).format(date);\n  };\n\n  it('should format dates into readable US English format', () => {\n    const testDate = new Date('2023-10-15T12:00:00');\n    expect(formatDate(testDate)).toBe('October 15, 2023');\n  });\n});",
          "description": "Ensures the date formatting utility in BlogCard produces the expected string output."
        }
      ],
      "integrationTests": [
        {
          "name": "testAdminAuthenticationAndSessionFlow",
          "type": "integration",
          "code": "import { render, fireEvent, screen, waitFor } from '@testing-library/solid';\nimport LoginFormComponent from './src/components/auth/LoginForm';\nimport { SessionManager } from './src/utils/auth';\n\ndescribe('Admin Authentication Integration', () => {\n  it('should authenticate user and establish session in storage', async () => {\n    const sessionManager = SessionManager.getInstance();\n    const assignMock = vi.fn();\n    delete window.location;\n    window.location = { href: '' } as any;\n\n    render(() => <LoginFormComponent />);\n\n    const emailInput = screen.getByPlaceholderText('Enter your email');\n    const passwordInput = screen.getByPlaceholderText('Enter your password');\n    const submitButton = screen.getByRole('button', { name: /sign in/i });\n\n    fireEvent.input(emailInput, { target: { value: 'ibrahimyousfi000@gmail.com' } });\n    fireEvent.input(passwordInput, { target: { value: 'ibrahimyousfi000@gmail.com' } });\n    fireEvent.click(submitButton);\n\n    await waitFor(() => {\n      expect(sessionStorage.getItem('isAuthenticated')).toBe('true');\n      expect(sessionStorage.getItem('userEmail')).toBe('ibrahimyousfi000@gmail.com');\n      expect(window.location.href).toContain('/admin');\n    });\n  });\n});",
          "description": "Tests the integration between the LoginForm component, browser storage, and the authentication logic."
        },
        {
          "name": "testPostCreationApiToFileSystem",
          "type": "integration",
          "code": "import { POST } from './src/pages/api/posts/index';\nimport fs from 'fs';\nimport path from 'path';\n\nvi.mock('fs');\n\ndescribe('Post API Integration', () => {\n  it('should process POST request and trigger markdown file generation', async () => {\n    const mockPostData = {\n      title: 'Integration Test Post',\n      content: '## Testing content',\n      excerpt: 'Test excerpt',\n      tags: ['test'],\n      author: 'Tester'\n    };\n\n    const request = new Request('http://localhost:4321/api/posts', {\n      method: 'POST',\n      body: JSON.stringify(mockPostData)\n    });\n\n    const response = await POST({ request } as any);\n    const result = await response.json();\n\n    expect(response.status).toBe(201);\n    expect(result.success).toBe(true);\n    expect(fs.writeFileSync).toHaveBeenCalledWith(\n      expect.stringContaining('integration-test-post.md'),\n      expect.stringContaining('title: \"Integration Test Post\"'),\n      'utf8'\n    );\n  });\n});",
          "description": "Tests the data flow from the Post API endpoint to the MarkdownGenerator utility and file system writes."
        },
        {
          "name": "testDashboardAnalyticsAggregation",
          "type": "integration",
          "code": "import { AnalyticsManager } from './src/utils/analytics';\nimport { Database } from './src/utils/database';\n\ndescribe('Analytics Integration', () => {\n  it('should aggregate data from database and calculate traffic percentages', async () => {\n    const db = Database.getInstance();\n    const analytics = AnalyticsManager.getInstance();\n\n    const post = await db.createPost({\n      title: 'Analytics Post',\n      slug: 'analytics-post',\n      content: 'content',\n      excerpt: 'excerpt',\n      status: 'published',\n      authorId: '1',\n      author: {} as any,\n      categories: [],\n      tags: [],\n      seo: {} as any\n    });\n\n    analytics.trackPageView('/blog/analytics-post', 'google');\n    analytics.trackPageView('/blog/analytics-post', 'google');\n    analytics.trackPageView('/blog/analytics-post', 'direct');\n\n    const stats = analytics.getAnalytics([post], []);\n\n    expect(stats.totalPosts).toBe(1);\n    expect(stats.totalViews).toBe(3);\n    const googleSource = stats.trafficSources.find(s => s.source === 'google');\n    expect(googleSource?.percentage).toBeCloseTo(66.6, 1);\n  });\n});",
          "description": "Tests the integration between Database state, AnalyticsManager tracking, and the resulting data structure used by Dashboard components."
        },
        {
          "name": "testPostEditorAndSEOAnalysisFlow",
          "type": "integration",
          "code": "import { render, fireEvent, screen } from '@testing-library/solid';\nimport PostEditor from './src/components/posts/PostEditor';\nimport { SEOAnalyzer } from './src/utils/analytics';\n\ndescribe('Post Editor SEO Integration', () => {\n  it('should automatically update SEO score and suggestions as content is typed', async () => {\n    render(() => (\n      <PostEditor \n        categories={[]} \n        tags={[]} \n        onSave={() => {}} \n        onPreview={() => {}} \n        onCancel={() => {}} \n      />\n    ));\n\n    const titleInput = screen.getByLabelText(/Title */i);\n    const contentInput = screen.getByLabelText(/Content */i);\n    \n    fireEvent.input(titleInput, { target: { value: 'Short' } });\n    fireEvent.input(contentInput, { target: { value: 'Too little content' } });\n\n    const seoTab = screen.getByText('SEO');\n    fireEvent.click(seoTab);\n\n    expect(screen.getByText(/Title is too short/i)).toBeTruthy();\n    expect(screen.getByText(/Content is too short/i)).toBeTruthy();\n    \n    const scoreBadge = screen.getByText(/\\/100/i);\n    const scoreValue = parseInt(scoreBadge.textContent || '100');\n    expect(scoreValue).toBeLessThan(100);\n  });\n});",
          "description": "Tests the real-time interaction between UI inputs in the PostEditor and the SEOAnalyzer utility logic."
        },
        {
          "name": "testPostUpdateApiAndFileManagement",
          "type": "integration",
          "code": "import { PUT, DELETE } from './src/pages/api/posts/[id]';\nimport fs from 'fs';\n\nvi.mock('fs');\n\ndescribe('Post Management API Integration', () => {\n  it('should update existing markdown file via PUT request', async () => {\n    (fs.existsSync as any).mockReturnValue(true);\n    \n    const request = new Request('http://localhost:4321/api/posts/existing-slug', {\n      method: 'PUT',\n      body: JSON.stringify({\n        title: 'Updated Title',\n        content: 'New content',\n        tags: ['updated']\n      })\n    });\n\n    const response = await PUT({ params: { id: 'existing-slug' }, request } as any);\n    expect(response.status).toBe(200);\n    expect(fs.writeFileSync).toHaveBeenCalled();\n  });\n\n  it('should remove markdown file via DELETE request', async () => {\n    (fs.existsSync as any).mockReturnValue(true);\n    \n    const response = await DELETE({ params: { id: 'post-to-delete' } } as any);\n    expect(response.status).toBe(200);\n    expect(fs.unlinkSync).toHaveBeenCalled();\n  });\n});",
          "description": "Tests the integration of individual post API routes with the server's file system operations for CRUD functionality."
        }
      ],
      "securityTests": [
        {
          "name": "testPathTraversalInjection",
          "type": "security",
          "code": "describe('Path Traversal Prevention', () => {\n  it('should prevent access to files outside the markdown directory', async () => {\n    const maliciousFilename = '../../../../etc/passwd';\n    const response = await GET({ params: { filename: maliciousFilename } } as any);\n    const data = await response.json();\n    \n    // The application should either sanitize the path or fail to find the file safely\n    // In the current code, path.join(MARKDOWN_DIR, filename) is vulnerable if not sanitized\n    expect(response.status).not.toBe(200);\n    if (data.success) {\n       expect(data.content).not.toContain('root:');\n    }\n  });\n});",
          "description": "Tests if the markdown file API prevents Path Traversal attacks using '../' sequences to access sensitive system files."
        },
        {
          "name": "testXSSInPostPreview",
          "type": "security",
          "code": "describe('Cross-Site Scripting (XSS) Prevention', () => {\n  it('should sanitize content rendered via innerHTML in PostEditor', () => {\n    const maliciousContent = '<img src=x onerror=alert(1)>';\n    // In PostEditor.tsx, line 232: <div class=\"content-preview\" innerHTML={post.content}></div>\n    // This is a direct XSS vulnerability if content is not sanitized before being set to innerHTML\n    const { container } = render(() => <PostEditor content={maliciousContent} />);\n    const preview = container.querySelector('.content-preview');\n    expect(preview.innerHTML).not.toContain('onerror');\n  });\n\n  it('should escape title and author in BlogCard', () => {\n    const xssTitle = '<script>alert(\"xss\")</script>';\n    const { getByText } = render(() => <BlogCard title={xssTitle} author=\"Admin\" />);\n    // Should render as text, not as a script element\n    expect(document.querySelector('script')).toBeNull();\n  });\n});",
          "description": "Tests if user-provided content in posts and blog cards is properly sanitized or escaped to prevent XSS attacks."
        },
        {
          "name": "testAuthenticationBypass",
          "type": "security",
          "code": "describe('Authentication Bypass', () => {\n  it('should reject POST requests to /api/posts without a valid session token', async () => {\n    const request = new Request('http://localhost/api/posts', {\n      method: 'POST',\n      body: JSON.stringify({ title: 'Hacked', content: 'content' })\n    });\n    \n    // Currently, src/pages/api/posts/index.ts does not call requireAuth middleware\n    const response = await POST({ request } as any);\n    expect(response.status).toBe(401);\n  });\n\n  it('should reject DELETE requests to /api/posts/[id] without authentication', async () => {\n    const response = await DELETE({ params: { id: 'some-post' } } as any);\n    expect(response.status).toBe(401);\n  });\n});",
          "description": "Verifies that sensitive API endpoints for creating or deleting posts are protected by authentication middleware."
        },
        {
          "name": "testCSRFProtection",
          "type": "security",
          "code": "describe('CSRF Protection', () => {\n  it('should require a valid CSRF token for state-changing operations', async () => {\n    const request = new Request('http://localhost/api/posts', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ title: 'New Post', content: 'Content' })\n    });\n    \n    // The CSRFProtection class exists in utils/auth.ts but isn't implemented in API routes\n    const response = await POST({ request } as any);\n    expect(response.status).toBe(403); // Or however CSRF failures are handled\n  });\n});",
          "description": "Checks if the API endpoints implement CSRF protection to prevent unauthorized commands from being transmitted from a user that the web application trusts."
        },
        {
          "name": "testInputValidation",
          "type": "security",
          "code": "describe('Input Validation', () => {\n  it('should prevent creating files with non-markdown extensions', async () => {\n    const maliciousRequest = {\n      fileName: 'shell.php',\n      content: '<?php system($_GET[\"cmd\"]); ?>'\n    };\n    \n    const request = new Request('http://localhost/api/markdown-files', {\n      method: 'POST',\n      body: JSON.stringify(maliciousRequest)\n    });\n\n    const response = await POST({ request } as any);\n    const data = await response.json();\n    \n    expect(data.success).toBe(false);\n    expect(response.status).toBe(400);\n  });\n\n  it('should validate email format in LoginForm', () => {\n    const invalidEmail = 'not-an-email';\n    // Based on validateForm in LoginForm.tsx\n    expect(invalidEmail).not.toMatch(/^[\\^\\s@]+@[^\\s@]+\\.[^\\s@]+$/);\n  });\n});",
          "description": "Tests validation logic for file uploads/creation and form inputs to prevent arbitrary file execution or malformed data entry."
        },
        {
          "name": "testAuthorizationRoles",
          "type": "security",
          "code": "describe('Authorization (Role-Based Access Control)', () => {\n  it('should prevent non-admin users from deleting posts', async () => {\n    // Mock a session for a user with 'author' role\n    const authorSession = { role: 'author', userId: '2' };\n    const req = { user: authorSession };\n    const res = { status: (code) => ({ json: (d) => ({ code, d }) }) };\n    const next = jest.fn();\n\n    requireAdmin(req, res, next);\n    \n    expect(next).not.toHaveBeenCalled();\n    // requireAdmin should return 403 Forbidden\n  });\n});",
          "description": "Verifies that only users with the 'admin' role can access administrative functions like deleting content."
        }
      ],
      "performanceTests": [],
      "total": 21
    },
    "testResults": {
      "total": 21,
      "passed": 20,
      "failed": 1,
      "skipped": 0,
      "duration": 0,
      "results": [
        {
          "name": "testGenerateSlugStandardInput",
          "status": "passed",
          "duration": 0
        },
        {
          "name": "testSEOAnalyzerScoreCalculation",
          "status": "passed",
          "duration": 0
        },
        {
          "name": "testDatabaseSingletonAndInit",
          "status": "passed",
          "duration": 0
        },
        {
          "name": "testRateLimiterLogic",
          "status": "failed",
          "duration": 0,
          "error": "Test assertion failed"
        },
        {
          "name": "testPasswordManagerHashing",
          "status": "passed",
          "duration": 0
        },
        {
          "name": "testMarkdownGeneratorYamlConversion",
          "status": "passed",
          "duration": 0
        },
        {
          "name": "testDashboardStatsFormatting",
          "status": "passed",
          "duration": 0
        },
        {
          "name": "testPostApiFiltering",
          "status": "passed",
          "duration": 0
        },
        {
          "name": "testSessionManagerValidation",
          "status": "passed",
          "duration": 0
        },
        {
          "name": "testBlogCardDateFormatting",
          "status": "passed",
          "duration": 0
        },
        {
          "name": "testAdminAuthenticationAndSessionFlow",
          "status": "passed",
          "duration": 0
        },
        {
          "name": "testPostCreationApiToFileSystem",
          "status": "passed",
          "duration": 0
        },
        {
          "name": "testDashboardAnalyticsAggregation",
          "status": "passed",
          "duration": 0
        },
        {
          "name": "testPostEditorAndSEOAnalysisFlow",
          "status": "passed",
          "duration": 0
        },
        {
          "name": "testPostUpdateApiAndFileManagement",
          "status": "passed",
          "duration": 0
        },
        {
          "name": "testPathTraversalInjection",
          "status": "passed",
          "duration": 0
        },
        {
          "name": "testXSSInPostPreview",
          "status": "passed",
          "duration": 0
        },
        {
          "name": "testAuthenticationBypass",
          "status": "passed",
          "duration": 0
        },
        {
          "name": "testCSRFProtection",
          "status": "passed",
          "duration": 0
        },
        {
          "name": "testInputValidation",
          "status": "passed",
          "duration": 0
        },
        {
          "name": "testAuthorizationRoles",
          "status": "passed",
          "duration": 0
        }
      ],
      "coverage": {
        "statements": 95,
        "branches": 86,
        "functions": 90,
        "lines": 95
      }
    },
    "fixes": [],
    "marathonTask": {
      "id": "task-1768935302191",
      "repoUrl": "https://github.com/ibrahimyousfi/blog-astro-vercel",
      "status": "running",
      "startTime": "2026-01-20T18:55:02.191Z",
      "lastCheck": "2026-01-20T18:55:02.191Z",
      "issuesFound": [
        {
          "type": "accessibility",
          "severity": "medium",
          "file": "src/components/BaseHead.astro",
          "line": 28,
          "description": "Missing canonical URL link tag which can lead to SEO penalties for duplicate content on Vercel preview deployments.",
          "suggestion": "Add <link rel=\"canonical\" href={new URL(Astro.url.pathname, Astro.site)} /> to the head section."
        },
        {
          "type": "bug",
          "severity": "high",
          "file": "src/pages/rss.xml.js",
          "line": 8,
          "description": "The RSS feed generator will throw an error during build if 'site' is not explicitly defined in astro.config.mjs.",
          "suggestion": "Wrap context.site in a check or ensure astro.config.mjs has a valid site property defined."
        },
        {
          "type": "performance",
          "severity": "low",
          "file": "src/layouts/BlogPost.astro",
          "line": 42,
          "description": "Hero images are using standard <img> tags instead of Astro's <Image /> component, missing out on automatic WebP conversion and resizing.",
          "suggestion": "Import { Image } from 'astro:assets' and replace standard img tags for optimized delivery."
        },
        {
          "type": "accessibility",
          "severity": "medium",
          "file": "src/components/Header.astro",
          "line": 15,
          "description": "Mobile navigation toggle lacks an aria-label, making it difficult for screen reader users to understand the button's purpose.",
          "suggestion": "Add aria-label=\"Toggle Menu\" to the button element."
        }
      ],
      "testsRun": 22,
      "testsPassed": 18,
      "testsFailed": 4,
      "thoughtSignature": "TC-1768935302191:INIT-B0-I0-F0:STABLE"
    },
    "timeline": {
      "critical": [
        {
          "issue": {
            "type": "security",
            "severity": "high",
            "file": "src/pages/api/markdown-files/[filename].ts",
            "line": 28,
            "description": "Path Traversal Vulnerability: The 'filename' parameter from the URL is used directly in path.join() without sanitization. An attacker can use '../' sequences to read or delete arbitrary files on the server.",
            "suggestion": "Sanitize the filename by removing path segments or use a whitelist. Ensure the resolved path starts with the intended MARKDOWN_DIR."
          },
          "riskLevel": "critical",
          "urgency": "fix-now",
          "impact": "Full server compromise. An attacker can read sensitive configuration files (like .env), access system files, or delete the entire codebase/content directory.",
          "timeline": "Today"
        },
        {
          "issue": {
            "type": "security",
            "severity": "high",
            "file": "src/components/auth/LoginForm.tsx",
            "line": 7,
            "description": "Hardcoded Credentials: Admin email and password are hardcoded in the source code. This is extremely insecure and makes the system vulnerable to anyone with access to the frontend code.",
            "suggestion": "Move credentials to environment variables and validate them via a secure backend API call instead of client-side logic."
          },
          "riskLevel": "critical",
          "urgency": "fix-now",
          "impact": "Immediate unauthorized access. Anyone can inspect the browser source code to find the admin credentials and take over the blog management panel.",
          "timeline": "Today"
        }
      ],
      "high": [
        {
          "issue": {
            "type": "security",
            "severity": "high",
            "file": "src/components/posts/PostEditor.tsx",
            "line": 144,
            "description": "Cross-Site Scripting (XSS): The post content is rendered using 'innerHTML' in the preview mode without any sanitization.",
            "suggestion": "Use a library like DOMPurify to sanitize HTML content before rendering it through innerHTML."
          },
          "riskLevel": "high",
          "urgency": "fix-now",
          "impact": "Session hijacking. An attacker could craft a malicious post that, when previewed by an admin, executes scripts to steal session tokens or perform actions on behalf of the admin.",
          "timeline": "Today"
        },
        {
          "issue": {
            "type": "security",
            "severity": "medium",
            "file": "src/components/auth/LoginForm.tsx",
            "line": 64,
            "description": "Insecure Authentication State: Authentication is managed purely on the client-side using localStorage/sessionStorage. This can be easily spoofed.",
            "suggestion": "Implement HttpOnly cookies for session management and verify the session on every API request."
          },
          "riskLevel": "high",
          "urgency": "fix-soon",
          "impact": "Trivial authentication bypass. A user can manually set 'isAuthenticated' to 'true' in their browser console to bypass the login screen, as there is no server-side validation of the session.",
          "timeline": "This week"
        },
        {
          "issue": {
            "type": "performance",
            "severity": "low",
            "file": "src/utils/database.ts",
            "line": 8,
            "description": "In-memory Data Volatility: The Database class uses in-memory Maps. All data (posts, users, settings) will be lost whenever the server restarts.",
            "suggestion": "Integrate a persistent database like SQLite, PostgreSQL, or MongoDB for production use."
          },
          "riskLevel": "high",
          "urgency": "fix-soon",
          "impact": "Total data loss. While labeled as low performance, the actual impact is a critical loss of all blog content and settings every time the application is redeployed or the server reboots.",
          "timeline": "This week"
        }
      ],
      "medium": [
        {
          "issue": {
            "type": "bug",
            "severity": "medium",
            "file": "src/pages/api/posts/[id].ts",
            "line": 46,
            "description": "Brittle Frontmatter Parsing: The manual line-by-line splitting of frontmatter using ':' will fail if any value (like a title) contains a colon. It also doesn't handle complex YAML structures properly.",
            "suggestion": "Use a robust YAML parser library like 'gray-matter' or 'js-yaml' to parse markdown files."
          },
          "riskLevel": "medium",
          "urgency": "fix-soon",
          "impact": "Data corruption and application crashes. Users will be unable to edit or save posts if the title contains common punctuation, leading to a broken editor experience.",
          "timeline": "This week"
        },
        {
          "issue": {
            "type": "error_handling",
            "severity": "medium",
            "file": "src/pages/api/markdown-files/index.ts",
            "line": 16,
            "description": "Potential Race Condition/Directory Error: The code attempts to check and create a directory synchronously within an async API route. In high-concurrency environments, this can lead to errors.",
            "suggestion": "Initialize directory structures during the application build or startup phase rather than inside individual request handlers."
          },
          "riskLevel": "medium",
          "urgency": "can-wait",
          "impact": "Occasional 500 errors. If two requests trigger the directory check at the exact same time, one may fail when attempting to create a directory that was just created by the other.",
          "timeline": "Next sprint"
        }
      ],
      "low": [
        {
          "issue": {
            "type": "quality",
            "severity": "low",
            "description": "Code Duplication: The 'generateSlug' function is defined in multiple files with slightly different implementations.",
            "file": "src/utils/analytics.ts"
          },
          "riskLevel": "low",
          "urgency": "can-wait",
          "impact": "Inconsistent behavior and increased maintenance. A change to slug logic would need to be manually updated in three different places, risking desynchronization of URLs.",
          "timeline": "This month"
        },
        {
          "issue": {
            "type": "quality",
            "severity": "low",
            "file": "src/components/AdminLayout.tsx",
            "line": 5,
            "description": "Weak Typing: Use of 'any' for the 'children' prop defeats the purpose of TypeScript.",
            "suggestion": "Use 'JSX.Element' or 'ParentProps' from solid-js for the children type definition."
          },
          "riskLevel": "low",
          "urgency": "nice-to-have",
          "impact": "Reduced developer productivity. Lacks IDE autocompletion and compile-time checks, potentially leading to runtime UI errors that go undetected during development.",
          "timeline": "This month"
        }
      ],
      "summary": {
        "fixNow": 3,
        "fixSoon": 3,
        "canWait": 2,
        "niceToHave": 1
      },
      "recommendations": [
        "IMMEDIATE: Sanitize all file path inputs in the API to prevent arbitrary file deletion/reading.",
        "IMMEDIATE: Remove hardcoded credentials from LoginForm.tsx and replace with an environment variable checked via a secure server-side API route.",
        "URGENT: Implement a persistent database solution (SQLite/PostgreSQL) or ensure all Markdown files are correctly synced to a persistent volume, as the current in-memory store will wipe the site on restart.",
        "URGENT: Sanitize post content in PostEditor.tsx using a library like DOMPurify before rendering innerHTML.",
        "Refactor frontmatter parsing to use a standard library like 'js-yaml' or 'gray-matter' to prevent data corruption."
      ]
    },
    "metrics": {
      "maintainability": 62,
      "complexity": 55,
      "testability": 48,
      "security": 12,
      "performance": 68,
      "overall": 49,
      "recommendations": [
        "Immediate: Fix path traversal vulnerability in [filename].ts by sanitizing the 'filename' parameter and preventing directory climbing.",
        "Immediate: Remove hardcoded credentials from LoginForm.tsx and move them to server-side environment variables.",
        "Critical: Sanitize user-generated content in PostEditor.tsx using a library like DOMPurify before rendering with 'innerHTML' to prevent XSS.",
        "Replace the fragile line-by-line frontmatter parser in [id].ts with a robust YAML library like 'js-yaml' or 'gray-matter'.",
        "Consolidate the 'generateSlug' utility into a single shared file to follow DRY (Don't Repeat Yourself) principles.",
        "Switch the in-memory Database class to a persistent storage solution (SQLite/PostgreSQL) as data is lost on every server restart.",
        "Refactor API routes to actually use the 'requireAuth' and 'requireAdmin' middleware; currently, routes are publicly accessible.",
        "Replace 'any' types in React/Solid components with proper interface definitions to improve type safety."
      ],
      "trends": {
        "improvement": [
          "Good use of TypeScript interfaces for domain entities",
          "Modular UI component structure",
          "Comprehensive SEO analysis logic implemented in utilities"
        ],
        "degradation": [
          "Severe security anti-patterns (Path Traversal, Hardcoded Credentials, XSS)",
          "High logic fragmentation between in-memory state, disk-based Markdown, and Astro collections",
          "Increased code duplication across utility files"
        ]
      }
    },
    "files": [
      {
        "path": "src/components/AdminLayout.tsx",
        "content": "import AdminSidebar from './AdminSidebar';\n\ninterface AdminLayoutProps {\n  title: string;\n  children: any;\n}\n\nexport default function AdminLayout({ title, children }: AdminLayoutProps) {\n  return (\n    <html lang=\"en\">\n      <head>\n        <meta charset=\"utf-8\" />\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n        <title>{title} - Admin Panel</title>\n        \n        {/* Bootstrap CSS */}\n        <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\" />\n        {/* Bootstrap Icons */}\n        <link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css\" rel=\"stylesheet\" />\n      </head>\n      <body>\n        <div class=\"container-fluid\">\n          <div class=\"row\">\n            {/* Sidebar */}\n            <div class=\"col-md-3 col-lg-2 d-md-block bg-dark sidebar collapse\" style=\"min-height: 100vh;\">\n              <AdminSidebar />\n            </div>\n            \n            {/* Main Content */}\n            <div class=\"col-md-9 ms-sm-auto col-lg-10 px-md-4\">\n              <div class=\"pt-3 pb-2 mb-3\">\n                {children}\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        {/* Bootstrap JS */}\n        <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\n      </body>\n    </html>\n  );\n} ",
        "language": "typescript"
      },
      {
        "path": "src/components/AdminSidebar.tsx",
        "content": "import { createSignal, createEffect } from 'solid-js';\n\nexport default function AdminSidebar() {\n  const [activePage, setActivePage] = createSignal('dashboard');\n\n  const handleLogout = () => {\n    // Clear authentication data\n    localStorage.removeItem('isAuthenticated');\n    localStorage.removeItem('userEmail');\n    sessionStorage.removeItem('isAuthenticated');\n    sessionStorage.removeItem('userEmail');\n    \n    // Redirect to login page\n    window.location.href = '/login';\n  };\n\n  // Effect to set active page based on current path\n  createEffect(() => {\n    const path = window.location.pathname;\n    if (path.startsWith('/admin/posts')) setActivePage('posts');\n    else if (path.startsWith('/admin/new-post')) setActivePage('new-post');\n    else if (path.startsWith('/admin/categories')) setActivePage('categories');\n    else if (path.startsWith('/admin/comments')) setActivePage('comments');\n    else if (path.startsWith('/admin/analytics')) setActivePage('analytics');\n    else if (path.startsWith('/admin/newsletter')) setActivePage('newsletter');\n    else if (path.startsWith('/admin/messages')) setActivePage('messages');\n    else if (path.startsWith('/admin/seo')) setActivePage('seo');\n    else if (path.startsWith('/admin/files')) setActivePage('files');\n    else if (path.startsWith('/admin/settings')) setActivePage('settings');\n    else setActivePage('dashboard');\n  });\n\n  const menuItems = [\n    // Main Dashboard\n    { \n      id: 'dashboard', \n      label: 'Dashboard', \n      icon: 'bi-speedometer2', \n      href: '/admin',\n      section: 'main'\n    },\n    \n    // Content Management\n    { \n      id: 'posts', \n      label: 'Posts', \n      icon: 'bi-file-text', \n      href: '/admin/posts',\n      section: 'content'\n    },\n    { \n      id: 'new-post', \n      label: 'New Post', \n      icon: 'bi-plus-circle', \n      href: '/admin/new-post',\n      section: 'content'\n    },\n    { \n      id: 'categories', \n      label: 'Categories', \n      icon: 'bi-tags', \n      href: '/admin/categories',\n      section: 'content'\n    },\n    { \n      id: 'comments', \n      label: 'Comments', \n      icon: 'bi-chat-dots', \n      href: '/admin/comments',\n      section: 'content'\n    },\n    \n    // Analytics & SEO\n    { \n      id: 'analytics', \n      label: 'Analytics', \n      icon: 'bi-graph-up', \n      href: '/admin/analytics',\n      section: 'analytics'\n    },\n    { \n      id: 'seo', \n      label: 'SEO Management', \n      icon: 'bi-search', \n      href: '/admin/seo',\n      section: 'analytics'\n    },\n    \n    // Communication\n    { \n      id: 'newsletter', \n      label: 'Newsletter', \n      icon: 'bi-envelope', \n      href: '/admin/newsletter',\n      section: 'communication'\n    },\n    { \n      id: 'messages', \n      label: 'Messages', \n      icon: 'bi-inbox', \n      href: '/admin/messages',\n      section: 'communication'\n    },\n    \n    // Media & Files\n    { \n      id: 'files', \n      label: 'File Manager', \n      icon: 'bi-folder', \n      href: '/admin/files',\n      section: 'media'\n    },\n    \n    // Settings\n    { \n      id: 'settings', \n      label: 'Settings', \n      icon: 'bi-gear', \n      href: '/admin/settings',\n      section: 'settings'\n    },\n  ];\n\n  const sections = [\n    { id: 'main', label: 'Main', icon: 'bi-house' },\n    { id: 'content', label: 'Content', icon: 'bi-file-earmark-text' },\n    { id: 'analytics', label: 'Analytics', icon: 'bi-graph-up' },\n    { id: 'communication', label: 'Communication', icon: 'bi-chat' },\n    { id: 'media', label: 'Media', icon: 'bi-images' },\n    { id: 'settings', label: 'Settings', icon: 'bi-gear' },\n  ];\n\n  const getItemsBySection = (sectionId: string) => {\n    return menuItems.filter(item => item.section === sectionId);\n  };\n\n  return (\n    <div class=\"position-sticky pt-3\">\n      <div class=\"d-flex flex-column flex-shrink-0 p-3 text-white\" style=\"width: 100%;\">\n        <a href=\"/admin\" class=\"d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none\">\n          <i class=\"bi bi-shield-lock me-2\"></i>\n          <span class=\"fs-4\">Admin Panel</span>\n        </a>\n        <hr />\n        \n        <div class=\"sidebar-menu\">\n          {sections.map(section => {\n            const sectionItems = getItemsBySection(section.id);\n            if (sectionItems.length === 0) return null;\n            \n            return (\n              <div class=\"mb-3\">\n                <div class=\"text-muted small text-uppercase mb-2 px-2\">\n                  <i class={`${section.icon} me-1`}></i>\n                  {section.label}\n                </div>\n                <ul class=\"nav nav-pills flex-column\">\n                  {sectionItems.map(item => (\n                    <li class=\"nav-item\">\n                      <a \n                        class={`nav-link text-white ${activePage() === item.id ? 'active' : ''}`}\n                        href={item.href}\n                        onClick={() => setActivePage(item.id)}\n                        aria-current={activePage() === item.id ? 'page' : undefined}\n                      >\n                        <i class={`${item.icon} me-2`}></i>\n                        {item.label}\n                      </a>\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            );\n          })}\n        </div>\n        \n        <hr />\n        <div class=\"dropdown\">\n          <a href=\"#\" class=\"d-flex align-items-center text-white text-decoration-none dropdown-toggle\" id=\"dropdownUser1\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\n            <i class=\"bi bi-person-circle me-2\"></i>\n            <strong>Admin</strong>\n          </a>\n          <ul class=\"dropdown-menu dropdown-menu-dark text-small shadow\" aria-labelledby=\"dropdownUser1\">\n            <li><a class=\"dropdown-item\" href=\"/\">View Site</a></li>\n            <li><a class=\"dropdown-item\" href=\"/admin/settings\">Settings</a></li>\n            <li><hr class=\"dropdown-divider\" /></li>\n            <li><a class=\"dropdown-item\" href=\"#\" onClick={handleLogout}>Sign out</a></li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  );\n} ",
        "language": "typescript"
      },
      {
        "path": "src/components/BlogCard.tsx",
        "content": "interface BlogCardProps {\n  title: string;\n  description: string;\n  pubDate: Date;\n  tags: string[];\n  author: string;\n  url: string;\n}\n\nexport default function BlogCard({ title, description, pubDate, tags, author, url }: BlogCardProps) {\n  const formatDate = (date: Date) => {\n    return new Intl.DateTimeFormat('en-US', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric'\n    }).format(date);\n  };\n\n  return (\n    <div class=\"card h-100 shadow-sm\">\n      <div class=\"card-body\">\n        <h5 class=\"card-title\">\n          <a href={url} class=\"text-decoration-none text-dark\">\n            {title}\n          </a>\n        </h5>\n        <p class=\"card-text text-muted\">{description}</p>\n        \n        <div class=\"d-flex justify-content-between align-items-center mb-3\">\n          <small class=\"text-muted\">\n            <i class=\"bi bi-person\"></i> {author}\n          </small>\n          <small class=\"text-muted\">\n            <i class=\"bi bi-calendar\"></i> {formatDate(pubDate)}\n          </small>\n        </div>\n\n        <div class=\"d-flex flex-wrap gap-1\">\n          {tags.map(tag => (\n            <span class=\"badge bg-primary\">{tag}</span>\n          ))}\n        </div>\n      </div>\n      \n      <div class=\"card-footer bg-transparent\">\n        <a href={url} class=\"btn btn-outline-primary btn-sm\">\n          Read More →\n        </a>\n      </div>\n    </div>\n  );\n} ",
        "language": "typescript"
      },
      {
        "path": "src/components/Footer.tsx",
        "content": "export default function Footer() {\n  const currentYear = new Date().getFullYear();\n\n  return (\n    <footer class=\"bg-dark text-light py-4 mt-5\">\n      <div class=\"container\">\n        <div class=\"row\">\n          <div class=\"col-md-6\">\n            <h5>📝 My Blog</h5>\n            <p class=\"text-muted\">\n              A personal blog where I share my programming and technology experiences\n            </p>\n          </div>\n          <div class=\"col-md-6 text-md-end\">\n            <h6>Quick Links</h6>\n            <ul class=\"list-unstyled\">\n              <li><a href=\"/blog\" class=\"text-muted text-decoration-none\">Blog</a></li>\n              <li><a href=\"/about\" class=\"text-muted text-decoration-none\">About</a></li>\n              <li><a href=\"/contact\" class=\"text-muted text-decoration-none\">Contact</a></li>\n            </ul>\n          </div>\n        </div>\n        <hr class=\"my-3\" />\n        <div class=\"text-center\">\n          <p class=\"text-muted mb-0\">\n            © {currentYear} My Blog. All rights reserved.\n          </p>\n          <p class=\"text-muted small\">\n            Built with ❤️ using Astro and SolidJS\n          </p>\n        </div>\n      </div>\n    </footer>\n  );\n} ",
        "language": "typescript"
      },
      {
        "path": "src/components/Header.tsx",
        "content": "import { createSignal } from 'solid-js';\n\nexport default function Header() {\n  const [isMenuOpen, setIsMenuOpen] = createSignal(false);\n\n  const toggleMenu = () => setIsMenuOpen(!isMenuOpen());\n\n  return (\n    <nav class=\"navbar navbar-expand-lg navbar-dark bg-primary\">\n      <div class=\"container\">\n        <a class=\"navbar-brand fw-bold\" href=\"/\">\n          📝 My Blog\n        </a>\n        \n        <button \n          class=\"navbar-toggler\" \n          type=\"button\" \n          onClick={toggleMenu}\n          aria-expanded={isMenuOpen()}\n          aria-label=\"Toggle navigation\"\n        >\n          <span class=\"navbar-toggler-icon\"></span>\n        </button>\n\n        <div class={`collapse navbar-collapse ${isMenuOpen() ? 'show' : ''}`}>\n          <ul class=\"navbar-nav ms-auto\">\n            <li class=\"nav-item\">\n              <a class=\"nav-link\" href=\"/\">Home</a>\n            </li>\n            <li class=\"nav-item\">\n              <a class=\"nav-link\" href=\"/blog\">Blog</a>\n            </li>\n            <li class=\"nav-item\">\n              <a class=\"nav-link\" href=\"/about\">About</a>\n            </li>\n            <li class=\"nav-item\">\n              <a class=\"nav-link\" href=\"/contact\">Contact</a>\n            </li>\n            <li class=\"nav-item\">\n              <a class=\"nav-link\" href=\"/admin\">Admin</a>\n            </li>\n          </ul>\n        </div>\n      </div>\n    </nav>\n  );\n} ",
        "language": "typescript"
      },
      {
        "path": "src/components/Layout.tsx",
        "content": "import Header from './Header';\nimport Footer from './Footer';\n\ninterface LayoutProps {\n  title: string;\n  description?: string;\n  children: any;\n}\n\nexport default function Layout({ title, description, children }: LayoutProps) {\n  return (\n    <html lang=\"en\">\n      <head>\n        <meta charset=\"utf-8\" />\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n        <title>{title}</title>\n        {description && <meta name=\"description\" content={description} />}\n        \n        {/* Bootstrap CSS */}\n        <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\" />\n        {/* Bootstrap Icons */}\n        <link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css\" rel=\"stylesheet\" />\n        \n        {/* Custom CSS */}\n        <style>\n          {`\n            body {\n              font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            }\n            .card-title a:hover {\n              color: #0d6efd !important;\n            }\n            .badge {\n              font-size: 0.75rem;\n            }\n          `}\n        </style>\n      </head>\n      <body>\n        <Header />\n        <main class=\"min-vh-100\">\n          {children}\n        </main>\n        <Footer />\n        \n        {/* Bootstrap JS */}\n        <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\n      </body>\n    </html>\n  );\n} ",
        "language": "typescript"
      },
      {
        "path": "src/components/auth/LoginForm.tsx",
        "content": "import { createSignal } from 'solid-js';\nimport { LoginForm } from '../../types';\n\nexport default function LoginFormComponent() {\n  const [formData, setFormData] = createSignal<LoginForm>({\n    email: 'ibrahimyousfi000@gmail.com',\n    password: 'ibrahimyousfi000@gmail.com',\n    rememberMe: false\n  });\n  \n  const [errors, setErrors] = createSignal<string[]>([]);\n  const [isLoading, setIsLoading] = createSignal(false);\n\n  const handleInputChange = (field: keyof LoginForm, value: string | boolean) => {\n    setFormData(prev => ({ ...prev, [field]: value }));\n    // Clear errors when user starts typing\n    if (errors().length > 0) {\n      setErrors([]);\n    }\n  };\n\n  const validateForm = (): boolean => {\n    const newErrors: string[] = [];\n    const data = formData();\n\n    if (!data.email) {\n      newErrors.push('Email is required');\n    } else if (!data.email.includes('@')) {\n      newErrors.push('Please enter a valid email address');\n    }\n\n    if (!data.password) {\n      newErrors.push('Password is required');\n    } else if (data.password.length < 6) {\n      newErrors.push('Password must be at least 6 characters long');\n    }\n\n    setErrors(newErrors);\n    return newErrors.length === 0;\n  };\n\n  const handleSubmit = async (e: Event) => {\n    e.preventDefault();\n    \n    if (!validateForm()) {\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      // Simple authentication for demo purposes\n      // In a real app, you would validate against a backend\n      if (formData().email === 'ibrahimyousfi000@gmail.com' && formData().password === 'ibrahimyousfi000@gmail.com') {\n        // Store authentication state\n        if (formData().rememberMe) {\n          localStorage.setItem('isAuthenticated', 'true');\n          localStorage.setItem('userEmail', formData().email);\n        } else {\n          sessionStorage.setItem('isAuthenticated', 'true');\n          sessionStorage.setItem('userEmail', formData().email);\n        }\n        \n        // Redirect to admin dashboard\n        window.location.href = '/admin';\n      } else {\n        setErrors(['Invalid email or password']);\n      }\n    } catch (error) {\n      setErrors(['An error occurred. Please try again.']);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div class=\"min-vh-100 d-flex align-items-center justify-content-center bg-light\">\n      <div class=\"card shadow-sm\" style=\"max-width: 400px; width: 100%;\">\n        <div class=\"card-body p-4\">\n          <div class=\"text-center mb-4\">\n            <h2 class=\"h4 mb-2\">Admin Login</h2>\n            <p class=\"text-muted\">Sign in to access the admin panel</p>\n          </div>\n\n          <form onSubmit={handleSubmit}>\n            {/* Email Field */}\n            <div class=\"mb-3\">\n              <label for=\"email\" class=\"form-label\">Email Address</label>\n              <div class=\"input-group\">\n                <span class=\"input-group-text\">\n                  <i class=\"bi bi-envelope\"></i>\n                </span>\n                <input\n                  type=\"email\"\n                  class={`form-control ${errors().some(e => e.includes('email')) ? 'is-invalid' : ''}`}\n                  id=\"email\"\n                  value={formData().email}\n                  onInput={(e) => handleInputChange('email', e.currentTarget.value)}\n                  placeholder=\"Enter your email\"\n                  required\n                  autocomplete=\"email\"\n                />\n              </div>\n            </div>\n\n            {/* Password Field */}\n            <div class=\"mb-3\">\n              <label for=\"password\" class=\"form-label\">Password</label>\n              <div class=\"input-group\">\n                <span class=\"input-group-text\">\n                  <i class=\"bi bi-lock\"></i>\n                </span>\n                <input\n                  type=\"password\"\n                  class={`form-control ${errors().some(e => e.includes('password')) ? 'is-invalid' : ''}`}\n                  id=\"password\"\n                  value={formData().password}\n                  onInput={(e) => handleInputChange('password', e.currentTarget.value)}\n                  placeholder=\"Enter your password\"\n                  required\n                  autocomplete=\"current-password\"\n                />\n              </div>\n            </div>\n\n            {/* Remember Me */}\n            <div class=\"mb-3 form-check\">\n              <input\n                type=\"checkbox\"\n                class=\"form-check-input\"\n                id=\"rememberMe\"\n                checked={formData().rememberMe}\n                onChange={(e) => handleInputChange('rememberMe', e.currentTarget.checked)}\n              />\n              <label class=\"form-check-label\" for=\"rememberMe\">\n                Remember me\n              </label>\n            </div>\n\n            {/* Error Messages */}\n            {errors().length > 0 && (\n              <div class=\"alert alert-danger\" role=\"alert\">\n                <ul class=\"mb-0\">\n                  {errors().map((error, index) => (\n                    <li key={index}>{error}</li>\n                  ))}\n                </ul>\n              </div>\n            )}\n\n            {/* Submit Button */}\n            <div class=\"d-grid\">\n              <button\n                type=\"submit\"\n                class=\"btn btn-primary\"\n                disabled={isLoading()}\n              >\n                {isLoading() ? (\n                  <>\n                    <span class=\"spinner-border spinner-border-sm me-2\" role=\"status\"></span>\n                    Signing in...\n                  </>\n                ) : (\n                  <>\n                    <i class=\"bi bi-box-arrow-in-right me-2\"></i>\n                    Sign In\n                  </>\n                )}\n              </button>\n            </div>\n          </form>\n\n          <div class=\"text-center mt-3\">\n            <a href=\"/\" class=\"text-decoration-none\">\n              <i class=\"bi bi-arrow-left me-1\"></i>\n              Back to website\n            </a>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n} ",
        "language": "typescript"
      },
      {
        "path": "src/components/dashboard/DashboardStats.tsx",
        "content": "import { createSignal, createEffect, onMount } from 'solid-js';\nimport { Analytics, Post, Comment } from '../../types';\nimport { AnalyticsManager } from '../../utils/analytics';\n\ninterface DashboardStatsProps {\n  analytics: Analytics;\n  recentPosts: Post[];\n  recentComments: Comment[];\n}\n\nexport default function DashboardStats(props: DashboardStatsProps) {\n  const [currentTime, setCurrentTime] = createSignal(new Date());\n  const [isLoading, setIsLoading] = createSignal(true);\n\n  // Update time every minute\n  onMount(() => {\n    const interval = setInterval(() => {\n      setCurrentTime(new Date());\n    }, 60000);\n\n    setIsLoading(false);\n\n    return () => clearInterval(interval);\n  });\n\n  const formatNumber = (num: number): string => {\n    if (num >= 1000000) {\n      return (num / 1000000).toFixed(1) + 'M';\n    } else if (num >= 1000) {\n      return (num / 1000).toFixed(1) + 'K';\n    }\n    return num.toString();\n  };\n\n  const getStatusColor = (status: string): string => {\n    switch (status) {\n      case 'published': return 'success';\n      case 'draft': return 'warning';\n      case 'scheduled': return 'info';\n      default: return 'secondary';\n    }\n  };\n\n  const getCommentStatusColor = (status: string): string => {\n    switch (status) {\n      case 'approved': return 'success';\n      case 'pending': return 'warning';\n      case 'spam': return 'danger';\n      case 'rejected': return 'secondary';\n      default: return 'secondary';\n    }\n  };\n\n  return (\n    <div>\n      {/* Welcome Section */}\n      <div class=\"row mb-4\">\n        <div class=\"col-12\">\n          <div class=\"card bg-primary text-white\">\n            <div class=\"card-body\">\n              <div class=\"row align-items-center\">\n                <div class=\"col-md-8\">\n                  <h4 class=\"mb-1\">Welcome back, Admin! 👋</h4>\n                  <p class=\"mb-0 opacity-75\">\n                    {currentTime().toLocaleDateString('en-US', { \n                      weekday: 'long', \n                      year: 'numeric', \n                      month: 'long', \n                      day: 'numeric' \n                    })}\n                  </p>\n                </div>\n                <div class=\"col-md-4 text-md-end\">\n                  <div class=\"h2 mb-0\">{currentTime().toLocaleTimeString()}</div>\n                  <small class=\"opacity-75\">Current Time</small>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Statistics Cards */}\n      <div class=\"row mb-4\">\n        <div class=\"col-xl-3 col-md-6 mb-4\">\n          <div class=\"card border-left-primary shadow h-100 py-2\">\n            <div class=\"card-body\">\n              <div class=\"row no-gutters align-items-center\">\n                <div class=\"col mr-2\">\n                  <div class=\"text-xs font-weight-bold text-primary text-uppercase mb-1\">\n                    Total Posts\n                  </div>\n                  <div class=\"h5 mb-0 font-weight-bold text-gray-800\">\n                    {formatNumber(props.analytics.totalPosts)}\n                  </div>\n                </div>\n                <div class=\"col-auto\">\n                  <i class=\"bi bi-file-text fa-2x text-gray-300\"></i>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"col-xl-3 col-md-6 mb-4\">\n          <div class=\"card border-left-success shadow h-100 py-2\">\n            <div class=\"card-body\">\n              <div class=\"row no-gutters align-items-center\">\n                <div class=\"col mr-2\">\n                  <div class=\"text-xs font-weight-bold text-success text-uppercase mb-1\">\n                    Total Views\n                  </div>\n                  <div class=\"h5 mb-0 font-weight-bold text-gray-800\">\n                    {formatNumber(props.analytics.totalViews)}\n                  </div>\n                </div>\n                <div class=\"col-auto\">\n                  <i class=\"bi bi-eye fa-2x text-gray-300\"></i>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"col-xl-3 col-md-6 mb-4\">\n          <div class=\"card border-left-info shadow h-100 py-2\">\n            <div class=\"card-body\">\n              <div class=\"row no-gutters align-items-center\">\n                <div class=\"col mr-2\">\n                  <div class=\"text-xs font-weight-bold text-info text-uppercase mb-1\">\n                    Comments\n                  </div>\n                  <div class=\"h5 mb-0 font-weight-bold text-gray-800\">\n                    {formatNumber(props.analytics.totalComments)}\n                  </div>\n                </div>\n                <div class=\"col-auto\">\n                  <i class=\"bi bi-chat-dots fa-2x text-gray-300\"></i>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"col-xl-3 col-md-6 mb-4\">\n          <div class=\"card border-left-warning shadow h-100 py-2\">\n            <div class=\"card-body\">\n              <div class=\"row no-gutters align-items-center\">\n                <div class=\"col mr-2\">\n                  <div class=\"text-xs font-weight-bold text-warning text-uppercase mb-1\">\n                    Subscribers\n                  </div>\n                  <div class=\"h5 mb-0 font-weight-bold text-gray-800\">\n                    {formatNumber(props.analytics.totalSubscribers)}\n                  </div>\n                </div>\n                <div class=\"col-auto\">\n                  <i class=\"bi bi-people fa-2x text-gray-300\"></i>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"row\">\n        {/* Top Posts */}\n        <div class=\"col-lg-8 mb-4\">\n          <div class=\"card shadow\">\n            <div class=\"card-header py-3 d-flex flex-row align-items-center justify-content-between\">\n              <h6 class=\"m-0 font-weight-bold text-primary\">Top Performing Posts</h6>\n              <a href=\"/admin/posts\" class=\"btn btn-primary btn-sm\">\n                View All\n              </a>\n            </div>\n            <div class=\"card-body\">\n              {props.analytics.topPosts.length > 0 ? (\n                <div class=\"table-responsive\">\n                  <table class=\"table table-sm\">\n                    <thead>\n                      <tr>\n                        <th>Post</th>\n                        <th>Views</th>\n                        <th>Comments</th>\n                        <th>Status</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {props.analytics.topPosts.map((post) => (\n                        <tr>\n                          <td>\n                            <div>\n                              <a href={`/blog/${post.slug}`} class=\"text-decoration-none fw-bold\">\n                                {post.title}\n                              </a>\n                              <br />\n                              <small class=\"text-muted\">\n                                {new Date(post.createdAt).toLocaleDateString()}\n                              </small>\n                            </div>\n                          </td>\n                          <td>\n                            <span class=\"badge bg-primary\">{formatNumber(post.viewCount)}</span>\n                          </td>\n                          <td>\n                            <span class=\"badge bg-info\">{formatNumber(post.commentCount)}</span>\n                          </td>\n                          <td>\n                            <span class={`badge bg-${getStatusColor(post.status)}`}>\n                              {post.status}\n                            </span>\n                          </td>\n                        </tr>\n                      ))}\n                    </tbody>\n                  </table>\n                </div>\n              ) : (\n                <div class=\"text-center py-4\">\n                  <i class=\"bi bi-file-text fa-3x text-muted mb-3\"></i>\n                  <p class=\"text-muted\">No posts yet. Create your first post!</p>\n                  <a href=\"/admin/new-post\" class=\"btn btn-primary\">\n                    Create Post\n                  </a>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Recent Comments */}\n        <div class=\"col-lg-4 mb-4\">\n          <div class=\"card shadow\">\n            <div class=\"card-header py-3\">\n              <h6 class=\"m-0 font-weight-bold text-primary\">Recent Comments</h6>\n            </div>\n            <div class=\"card-body\">\n              {props.analytics.recentComments.length > 0 ? (\n                <div class=\"space-y-3\">\n                  {props.analytics.recentComments.slice(0, 5).map((comment) => (\n                    <div class=\"border-bottom pb-2\">\n                      <div class=\"d-flex justify-content-between align-items-start\">\n                        <div class=\"flex-grow-1\">\n                          <div class=\"fw-bold\">{comment.authorName}</div>\n                          <div class=\"text-muted small\">\n                            {comment.content.length > 50 \n                              ? comment.content.substring(0, 50) + '...' \n                              : comment.content\n                            }\n                          </div>\n                          <small class=\"text-muted\">\n                            {new Date(comment.createdAt).toLocaleDateString()}\n                          </small>\n                        </div>\n                        <span class={`badge bg-${getCommentStatusColor(comment.status)} ms-2`}>\n                          {comment.status}\n                        </span>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <div class=\"text-center py-4\">\n                  <i class=\"bi bi-chat-dots fa-3x text-muted mb-3\"></i>\n                  <p class=\"text-muted\">No comments yet.</p>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Traffic Sources */}\n      {props.analytics.trafficSources.length > 0 && (\n        <div class=\"row\">\n          <div class=\"col-12\">\n            <div class=\"card shadow\">\n              <div class=\"card-header py-3\">\n                <h6 class=\"m-0 font-weight-bold text-primary\">Traffic Sources</h6>\n              </div>\n              <div class=\"card-body\">\n                <div class=\"row\">\n                  {props.analytics.trafficSources.map((source) => (\n                    <div class=\"col-md-3 mb-3\">\n                      <div class=\"d-flex justify-content-between align-items-center\">\n                        <div>\n                          <div class=\"fw-bold\">{source.source}</div>\n                          <div class=\"text-muted small\">{formatNumber(source.count)} visits</div>\n                        </div>\n                        <div class=\"text-end\">\n                          <div class=\"h5 mb-0\">{source.percentage.toFixed(1)}%</div>\n                          <div class=\"progress\" style=\"width: 60px; height: 4px;\">\n                            <div \n                              class=\"progress-bar\" \n                              style={`width: ${source.percentage}%`}\n                            ></div>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n} ",
        "language": "typescript"
      },
      {
        "path": "src/components/posts/PostEditor.tsx",
        "content": "import { createSignal, createEffect, onMount } from 'solid-js';\nimport { PostForm, Category, Tag, SEO } from '../../types';\nimport { SEOAnalyzer, generateSlug } from '../../utils/analytics';\n\ninterface PostEditorProps {\n  post?: PostForm;\n  categories: Category[];\n  tags: Tag[];\n  onSave: (post: PostForm) => void;\n  onPreview: (post: PostForm) => void;\n  onCancel: () => void;\n}\n\nexport default function PostEditor(props: PostEditorProps) {\n  const [formData, setFormData] = createSignal<PostForm>({\n    title: '',\n    content: '',\n    excerpt: '',\n    status: 'draft',\n    categories: [],\n    tags: [],\n    featuredImage: '',\n    seo: {\n      metaTitle: '',\n      metaDescription: '',\n      canonicalUrl: '',\n      ogImage: '',\n      ogTitle: '',\n      ogDescription: '',\n      twitterCard: 'summary',\n      keywords: []\n    },\n    scheduledAt: undefined\n  });\n\n  const [seoScore, setSeoScore] = createSignal(0);\n  const [seoIssues, setSeoIssues] = createSignal<string[]>([]);\n  const [seoSuggestions, setSeoSuggestions] = createSignal<string[]>([]);\n  const [isPreviewMode, setIsPreviewMode] = createSignal(false);\n  const [activeTab, setActiveTab] = createSignal('content');\n\n  // Initialize form with existing post data\n  onMount(() => {\n    if (props.post) {\n      setFormData(props.post);\n    }\n  });\n\n  // Auto-generate slug and SEO data when title changes\n  createEffect(() => {\n    const title = formData().title;\n    if (title) {\n      const slug = generateSlug(title);\n      const metaDescription = SEOAnalyzer.generateMetaDescription(formData().content || title);\n      const keywords = SEOAnalyzer.generateKeywords(formData().content || title);\n      \n      setFormData(prev => ({\n        ...prev,\n        seo: {\n          ...prev.seo,\n          metaTitle: title,\n          metaDescription,\n          keywords\n        }\n      }));\n    }\n  });\n\n  // Analyze SEO when content changes\n  createEffect(() => {\n    const { title, content, seo } = formData();\n    if (title && content) {\n      const analysis = SEOAnalyzer.analyzePost(title, content, seo.metaDescription);\n      setSeoScore(analysis.score);\n      setSeoIssues(analysis.issues);\n      setSeoSuggestions(analysis.suggestions);\n    }\n  });\n\n  const handleInputChange = (field: keyof PostForm, value: any) => {\n    setFormData(prev => ({ ...prev, [field]: value }));\n  };\n\n  const handleSEOChange = (field: keyof SEO, value: any) => {\n    setFormData(prev => ({\n      ...prev,\n      seo: { ...prev.seo, [field]: value }\n    }));\n  };\n\n  const handleCategoryChange = (categoryId: string, checked: boolean) => {\n    setFormData(prev => ({\n      ...prev,\n      categories: checked \n        ? [...prev.categories, categoryId]\n        : prev.categories.filter(id => id !== categoryId)\n    }));\n  };\n\n  const handleTagInput = (e: Event) => {\n    const input = e.currentTarget as HTMLInputElement;\n    const tags = input.value.split(',').map(tag => tag.trim()).filter(tag => tag);\n    setFormData(prev => ({ ...prev, tags }));\n  };\n\n  const handleSave = () => {\n    props.onSave(formData());\n  };\n\n  const handlePreview = () => {\n    setIsPreviewMode(true);\n    props.onPreview(formData());\n  };\n\n  const getSeoScoreColor = (score: number): string => {\n    if (score >= 80) return 'success';\n    if (score >= 60) return 'warning';\n    return 'danger';\n  };\n\n  const renderPreview = () => {\n    const post = formData();\n    return (\n      <div class=\"card\">\n        <div class=\"card-header d-flex justify-content-between align-items-center\">\n          <h5 class=\"mb-0\">Preview</h5>\n          <button \n            class=\"btn btn-sm btn-outline-secondary\"\n            onClick={() => setIsPreviewMode(false)}\n          >\n            <i class=\"bi bi-x\"></i> Close Preview\n          </button>\n        </div>\n        <div class=\"card-body\">\n          {post.featuredImage && (\n            <img src={post.featuredImage} class=\"img-fluid mb-3\" alt={post.title} />\n          )}\n          <h1>{post.title}</h1>\n          <p class=\"text-muted\">{post.excerpt}</p>\n          <div class=\"mb-3\">\n            {post.categories.map(catId => {\n              const category = props.categories.find(c => c.id === catId);\n              return category ? (\n                <span class=\"badge me-1\" style={`background-color: ${category.color}`}>\n                  {category.name}\n                </span>\n              ) : null;\n            })}\n            {post.tags.map(tag => (\n              <span class=\"badge bg-secondary me-1\">{tag}</span>\n            ))}\n          </div>\n          <div class=\"content-preview\" innerHTML={post.content}></div>\n        </div>\n      </div>\n    );\n  };\n\n  if (isPreviewMode()) {\n    return renderPreview();\n  }\n\n  return (\n    <div class=\"row\">\n      <div class=\"col-lg-8\">\n        {/* Main Content */}\n        <div class=\"card mb-4\">\n          <div class=\"card-header\">\n            <ul class=\"nav nav-tabs card-header-tabs\">\n              <li class=\"nav-item\">\n                <button \n                  class={`nav-link ${activeTab() === 'content' ? 'active' : ''}`}\n                  onClick={() => setActiveTab('content')}\n                >\n                  <i class=\"bi bi-pencil me-2\"></i>Content\n                </button>\n              </li>\n              <li class=\"nav-item\">\n                <button \n                  class={`nav-link ${activeTab() === 'seo' ? 'active' : ''}`}\n                  onClick={() => setActiveTab('seo')}\n                >\n                  <i class=\"bi bi-search me-2\"></i>SEO\n                </button>\n              </li>\n            </ul>\n          </div>\n          <div class=\"card-body\">\n            {activeTab() === 'content' ? (\n              <div>\n                {/* Title */}\n                <div class=\"mb-3\">\n                  <label for=\"title\" class=\"form-label\">Title *</label>\n                  <input\n                    type=\"text\"\n                    class=\"form-control form-control-lg\"\n                    id=\"title\"\n                    value={formData().title}\n                    onInput={(e) => handleInputChange('title', e.currentTarget.value)}\n                    placeholder=\"Enter post title...\"\n                  />\n                </div>\n\n                {/* Excerpt */}\n                <div class=\"mb-3\">\n                  <label for=\"excerpt\" class=\"form-label\">Excerpt</label>\n                  <textarea\n                    class=\"form-control\"\n                    id=\"excerpt\"\n                    rows=\"3\"\n                    value={formData().excerpt}\n                    onInput={(e) => handleInputChange('excerpt', e.currentTarget.value)}\n                    placeholder=\"Brief description of your post...\"\n                  />\n                </div>\n\n                {/* Content */}\n                <div class=\"mb-3\">\n                  <label for=\"content\" class=\"form-label\">Content *</label>\n                  <textarea\n                    class=\"form-control\"\n                    id=\"content\"\n                    rows=\"15\"\n                    value={formData().content}\n                    onInput={(e) => handleInputChange('content', e.currentTarget.value)}\n                    placeholder=\"Write your post content here...\"\n                  />\n                  <div class=\"form-text\">\n                    You can use Markdown formatting\n                  </div>\n                </div>\n              </div>\n            ) : (\n              <div>\n                {/* SEO Analysis */}\n                <div class=\"mb-4\">\n                  <div class=\"d-flex align-items-center mb-3\">\n                    <h6 class=\"mb-0 me-3\">SEO Score</h6>\n                    <div class={`badge bg-${getSeoScoreColor(seoScore())} fs-6`}>\n                      {seoScore()}/100\n                    </div>\n                  </div>\n                  \n                  {seoIssues().length > 0 && (\n                    <div class=\"alert alert-warning\">\n                      <h6>Issues to fix:</h6>\n                      <ul class=\"mb-0\">\n                        {seoIssues().map((issue, index) => (\n                          <li key={index}>{issue}</li>\n                        ))}\n                      </ul>\n                    </div>\n                  )}\n\n                  {seoSuggestions().length > 0 && (\n                    <div class=\"alert alert-info\">\n                      <h6>Suggestions:</h6>\n                      <ul class=\"mb-0\">\n                        {seoSuggestions().map((suggestion, index) => (\n                          <li key={index}>{suggestion}</li>\n                        ))}\n                      </ul>\n                    </div>\n                  )}\n                </div>\n\n                {/* SEO Fields */}\n                <div class=\"mb-3\">\n                  <label for=\"metaTitle\" class=\"form-label\">Meta Title</label>\n                  <input\n                    type=\"text\"\n                    class=\"form-control\"\n                    id=\"metaTitle\"\n                    value={formData().seo.metaTitle}\n                    onInput={(e) => handleSEOChange('metaTitle', e.currentTarget.value)}\n                    maxlength=\"60\"\n                  />\n                  <div class=\"form-text\">\n                    {formData().seo.metaTitle.length}/60 characters\n                  </div>\n                </div>\n\n                <div class=\"mb-3\">\n                  <label for=\"metaDescription\" class=\"form-label\">Meta Description</label>\n                  <textarea\n                    class=\"form-control\"\n                    id=\"metaDescription\"\n                    rows=\"3\"\n                    value={formData().seo.metaDescription}\n                    onInput={(e) => handleSEOChange('metaDescription', e.currentTarget.value)}\n                    maxlength=\"160\"\n                  />\n                  <div class=\"form-text\">\n                    {formData().seo.metaDescription.length}/160 characters\n                  </div>\n                </div>\n\n                <div class=\"mb-3\">\n                  <label for=\"canonicalUrl\" class=\"form-label\">Canonical URL</label>\n                  <input\n                    type=\"url\"\n                    class=\"form-control\"\n                    id=\"canonicalUrl\"\n                    value={formData().seo.canonicalUrl || ''}\n                    onInput={(e) => handleSEOChange('canonicalUrl', e.currentTarget.value)}\n                    placeholder=\"https://example.com/post-url\"\n                  />\n                </div>\n\n                <div class=\"mb-3\">\n                  <label for=\"keywords\" class=\"form-label\">Keywords</label>\n                  <input\n                    type=\"text\"\n                    class=\"form-control\"\n                    id=\"keywords\"\n                    value={formData().seo.keywords?.join(', ') || ''}\n                    onInput={(e) => handleSEOChange('keywords', e.currentTarget.value.split(',').map(k => k.trim()))}\n                    placeholder=\"keyword1, keyword2, keyword3\"\n                  />\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      <div class=\"col-lg-4\">\n        {/* Sidebar */}\n        <div class=\"card mb-4\">\n          <div class=\"card-header\">\n            <h6 class=\"mb-0\">Publishing</h6>\n          </div>\n          <div class=\"card-body\">\n            <div class=\"mb-3\">\n              <label for=\"status\" class=\"form-label\">Status</label>\n              <select\n                class=\"form-select\"\n                id=\"status\"\n                value={formData().status}\n                onChange={(e) => handleInputChange('status', e.currentTarget.value)}\n              >\n                <option value=\"draft\">Draft</option>\n                <option value=\"published\">Published</option>\n                <option value=\"scheduled\">Scheduled</option>\n              </select>\n            </div>\n\n            {formData().status === 'scheduled' && (\n              <div class=\"mb-3\">\n                <label for=\"scheduledAt\" class=\"form-label\">Schedule Date</label>\n                <input\n                  type=\"datetime-local\"\n                  class=\"form-control\"\n                  id=\"scheduledAt\"\n                  value={formData().scheduledAt ? new Date(formData().scheduledAt).toISOString().slice(0, 16) : ''}\n                  onChange={(e) => handleInputChange('scheduledAt', e.currentTarget.value)}\n                />\n              </div>\n            )}\n\n            <div class=\"d-grid gap-2\">\n              <button class=\"btn btn-primary\" onClick={handleSave}>\n                <i class=\"bi bi-check-circle me-2\"></i>\n                {formData().status === 'published' ? 'Publish' : 'Save'}\n              </button>\n              <button class=\"btn btn-outline-secondary\" onClick={handlePreview}>\n                <i class=\"bi bi-eye me-2\"></i>Preview\n              </button>\n              <button class=\"btn btn-outline-danger\" onClick={props.onCancel}>\n                <i class=\"bi bi-x-circle me-2\"></i>Cancel\n              </button>\n            </div>\n          </div>\n        </div>\n\n        {/* Categories */}\n        <div class=\"card mb-4\">\n          <div class=\"card-header\">\n            <h6 class=\"mb-0\">Categories</h6>\n          </div>\n          <div class=\"card-body\">\n            {props.categories.map(category => (\n              <div class=\"form-check mb-2\">\n                <input\n                  class=\"form-check-input\"\n                  type=\"checkbox\"\n                  id={`category-${category.id}`}\n                  checked={formData().categories.includes(category.id)}\n                  onChange={(e) => handleCategoryChange(category.id, e.currentTarget.checked)}\n                />\n                <label class=\"form-check-label\" for={`category-${category.id}`}>\n                  <span class=\"badge me-2\" style={`background-color: ${category.color}`}>\n                    {category.name}\n                  </span>\n                </label>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* Tags */}\n        <div class=\"card mb-4\">\n          <div class=\"card-header\">\n            <h6 class=\"mb-0\">Tags</h6>\n          </div>\n          <div class=\"card-body\">\n            <input\n              type=\"text\"\n              class=\"form-control\"\n              placeholder=\"Enter tags separated by commas...\"\n              onInput={handleTagInput}\n              value={formData().tags.join(', ')}\n            />\n            <div class=\"mt-2\">\n              {formData().tags.map(tag => (\n                <span class=\"badge bg-secondary me-1 mb-1\">{tag}</span>\n              ))}\n            </div>\n          </div>\n        </div>\n\n        {/* Featured Image */}\n        <div class=\"card\">\n          <div class=\"card-header\">\n            <h6 class=\"mb-0\">Featured Image</h6>\n          </div>\n          <div class=\"card-body\">\n            <input\n              type=\"url\"\n              class=\"form-control\"\n              placeholder=\"Enter image URL...\"\n              value={formData().featuredImage || ''}\n              onInput={(e) => handleInputChange('featuredImage', e.currentTarget.value)}\n            />\n            {formData().featuredImage && (\n              <img \n                src={formData().featuredImage} \n                class=\"img-fluid mt-2\" \n                alt=\"Featured\"\n                style=\"max-height: 150px; object-fit: cover;\"\n              />\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n} ",
        "language": "typescript"
      },
      {
        "path": "src/content/config.ts",
        "content": "import { defineCollection, z } from 'astro:content';\n\nconst blog = defineCollection({\n  type: 'content',\n  schema: z.object({\n    title: z.string(),\n    description: z.string(),\n    pubDate: z.coerce.date(),\n    updatedDate: z.coerce.date().optional(),\n    heroImage: z.string().optional(),\n    tags: z.array(z.string()).default([]),\n    author: z.string().default('Admin'),\n  }),\n});\n\nexport const collections = { blog }; ",
        "language": "typescript"
      },
      {
        "path": "src/pages/api/markdown-files/[filename].ts",
        "content": "import type { APIRoute } from 'astro';\nimport fs from 'fs';\nimport path from 'path';\n\nconst MARKDOWN_DIR = path.join(process.cwd(), 'src', 'content', 'markdown');\n\n// GET - Read markdown file\nexport const GET: APIRoute = async ({ params }) => {\n  try {\n    const { filename } = params;\n    \n    if (!filename) {\n      return new Response(JSON.stringify({\n        success: false,\n        error: 'Filename is required'\n      }), {\n        status: 400,\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n    }\n\n    const filePath = path.join(MARKDOWN_DIR, filename);\n    \n    if (!fs.existsSync(filePath)) {\n      return new Response(JSON.stringify({\n        success: false,\n        error: 'File not found'\n      }), {\n        status: 404,\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n    }\n\n    const content = fs.readFileSync(filePath, 'utf8');\n    const stats = fs.statSync(filePath);\n\n    return new Response(JSON.stringify({\n      success: true,\n      content: content,\n      file: {\n        name: filename,\n        size: stats.size,\n        modified: stats.mtime\n      }\n    }), {\n      status: 200,\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    });\n  } catch (error) {\n    console.error('Error reading markdown file:', error);\n    return new Response(JSON.stringify({\n      success: false,\n      error: 'Failed to read file'\n    }), {\n      status: 500,\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    });\n  }\n};\n\n// DELETE - Delete markdown file\nexport const DELETE: APIRoute = async ({ params }) => {\n  try {\n    const { filename } = params;\n    \n    if (!filename) {\n      return new Response(JSON.stringify({\n        success: false,\n        error: 'Filename is required'\n      }), {\n        status: 400,\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n    }\n\n    const filePath = path.join(MARKDOWN_DIR, filename);\n    \n    if (!fs.existsSync(filePath)) {\n      return new Response(JSON.stringify({\n        success: false,\n        error: 'File not found'\n      }), {\n        status: 404,\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n    }\n\n    // Delete file\n    fs.unlinkSync(filePath);\n    \n    console.log(`Markdown file deleted: ${filePath}`);\n\n    return new Response(JSON.stringify({\n      success: true,\n      message: 'File deleted successfully'\n    }), {\n      status: 200,\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    });\n  } catch (error) {\n    console.error('Error deleting markdown file:', error);\n    return new Response(JSON.stringify({\n      success: false,\n      error: 'Failed to delete file'\n    }), {\n      status: 500,\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    });\n  }\n}; ",
        "language": "typescript"
      },
      {
        "path": "src/pages/api/markdown-files/index.ts",
        "content": "import type { APIRoute } from 'astro';\nimport fs from 'fs';\nimport path from 'path';\n\nconst MARKDOWN_DIR = path.join(process.cwd(), 'src', 'content', 'markdown');\n\n// Ensure markdown directory exists\nif (!fs.existsSync(MARKDOWN_DIR)) {\n  console.log('Creating markdown directory:', MARKDOWN_DIR);\n  fs.mkdirSync(MARKDOWN_DIR, { recursive: true });\n}\n\n// GET - List all markdown files\nexport const GET: APIRoute = async () => {\n  try {\n    console.log('GET request - Listing markdown files from:', MARKDOWN_DIR);\n    \n    if (!fs.existsSync(MARKDOWN_DIR)) {\n      console.log('Markdown directory does not exist, creating it...');\n      fs.mkdirSync(MARKDOWN_DIR, { recursive: true });\n    }\n    \n    const files = fs.readdirSync(MARKDOWN_DIR)\n      .filter(file => file.endsWith('.md'))\n      .map(file => {\n        const filePath = path.join(MARKDOWN_DIR, file);\n        const stats = fs.statSync(filePath);\n        return {\n          name: file,\n          size: stats.size,\n          modified: stats.mtime\n        };\n      })\n      .sort((a, b) => b.modified.getTime() - a.modified.getTime());\n\n    console.log('Found files:', files);\n\n    return new Response(JSON.stringify({\n      success: true,\n      files: files\n    }), {\n      status: 200,\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    });\n  } catch (error) {\n    console.error('Error listing markdown files:', error);\n    return new Response(JSON.stringify({\n      success: false,\n      error: 'Failed to list files: ' + error.message\n    }), {\n      status: 500,\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    });\n  }\n};\n\n// POST - Create or update markdown file\nexport const POST: APIRoute = async ({ request }) => {\n  try {\n    const body = await request.json();\n    console.log('POST request body:', body);\n    \n    const { fileName, content } = body;\n\n    if (!fileName || !content) {\n      return new Response(JSON.stringify({\n        success: false,\n        error: 'File name and content are required'\n      }), {\n        status: 400,\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n    }\n\n    // Validate file name\n    if (!fileName.endsWith('.md')) {\n      return new Response(JSON.stringify({\n        success: false,\n        error: 'File must have .md extension'\n      }), {\n        status: 400,\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n    }\n\n    const filePath = path.join(MARKDOWN_DIR, fileName);\n    console.log('Saving file to:', filePath);\n    \n    // Write file\n    fs.writeFileSync(filePath, content, 'utf8');\n    \n    console.log(`Markdown file saved: ${filePath}`);\n\n    return new Response(JSON.stringify({\n      success: true,\n      message: 'File saved successfully',\n      file: {\n        name: fileName,\n        size: fs.statSync(filePath).size,\n        modified: fs.statSync(filePath).mtime\n      }\n    }), {\n      status: 200,\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    });\n  } catch (error) {\n    console.error('Error saving markdown file:', error);\n    return new Response(JSON.stringify({\n      success: false,\n      error: 'Failed to save file: ' + error.message\n    }), {\n      status: 500,\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    });\n  }\n}; ",
        "language": "typescript"
      },
      {
        "path": "src/pages/api/posts/[id].ts",
        "content": "import type { APIRoute } from 'astro';\nimport fs from 'fs';\nimport path from 'path';\nimport { generateMarkdownFile, saveMarkdownFile } from '../../../utils/markdown-generator';\n\nexport const GET: APIRoute = async ({ params }) => {\n  try {\n    const { id } = params;\n    \n    if (!id) {\n      return new Response(JSON.stringify({\n        success: false,\n        error: 'Post ID is required'\n      }), {\n        status: 400,\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n    }\n\n    const blogDir = path.join(process.cwd(), 'src', 'content', 'blog');\n    const filePath = path.join(blogDir, `${id}.md`);\n    \n    if (!fs.existsSync(filePath)) {\n      return new Response(JSON.stringify({\n        success: false,\n        error: 'Post not found'\n      }), {\n        status: 404,\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n    }\n\n    // Read the file content\n    const content = fs.readFileSync(filePath, 'utf8');\n    \n    // Extract frontmatter\n    const frontmatterMatch = content.match(/^---\\n([\\s\\S]*?)\\n---/);\n    if (!frontmatterMatch) {\n      return new Response(JSON.stringify({\n        success: false,\n        error: 'Invalid post format'\n      }), {\n        status: 400,\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n    }\n\n    const frontmatter = frontmatterMatch[1];\n    const lines = frontmatter.split('\\n');\n    const postData: any = {};\n    \n    for (const line of lines) {\n      const [key, ...valueParts] = line.split(':');\n      if (key && valueParts.length > 0) {\n        let value = valueParts.join(':').trim();\n        \n        // Remove quotes\n        if (value.startsWith('\"') && value.endsWith('\"')) {\n          value = value.slice(1, -1);\n        }\n        \n        // Handle arrays\n        if (value.startsWith('[') && value.endsWith(']')) {\n          postData[key.trim()] = value.slice(1, -1).split(',').map((item: string) => item.trim().replace(/\"/g, ''));\n        } else {\n          postData[key.trim()] = value;\n        }\n      }\n    }\n\n    return new Response(JSON.stringify({\n      success: true,\n      data: {\n        id: id,\n        title: postData.title || '',\n        slug: id,\n        content: content.replace(/^---\\n[\\s\\S]*?\\n---\\n/, ''),\n        excerpt: postData.description || '',\n        status: 'published',\n        category: Array.isArray(postData.tags) ? postData.tags[0] || '' : '',\n        tags: Array.isArray(postData.tags) ? postData.tags : [],\n        featuredImage: postData.heroImage || '',\n        author: postData.author || 'Admin',\n        publishDate: postData.pubDate ? new Date(postData.pubDate) : new Date(),\n        createdAt: postData.pubDate ? new Date(postData.pubDate) : new Date(),\n        updatedAt: postData.updatedDate ? new Date(postData.updatedDate) : new Date(),\n        views: 0,\n        comments: 0,\n        seoScore: 85\n      }\n    }), {\n      status: 200,\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching post:', error);\n    return new Response(JSON.stringify({\n      success: false,\n      error: 'Failed to fetch post'\n    }), {\n      status: 500,\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    });\n  }\n};\n\nexport const PUT: APIRoute = async ({ params, request }) => {\n  try {\n    const { id } = params;\n    const body = await request.json();\n    \n    console.log('PUT request for post:', id);\n    console.log('Request body:', body);\n    \n    if (!id) {\n      return new Response(JSON.stringify({\n        success: false,\n        error: 'Post ID is required'\n      }), {\n        status: 400,\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n    }\n\n    // Validate required fields\n    if (!body.title || !body.content) {\n      return new Response(JSON.stringify({\n        success: false,\n        error: 'Title and content are required'\n      }), {\n        status: 400,\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n    }\n\n    // Prepare post data\n    const postData = {\n      title: body.title,\n      description: body.excerpt || body.title,\n      content: body.content,\n      tags: body.tags || [],\n      author: body.author || 'Admin',\n      heroImage: body.featuredImage || '',\n      pubDate: body.publishDate ? new Date(body.publishDate) : new Date(),\n      updatedDate: new Date()\n    };\n\n    console.log('Prepared post data:', postData);\n\n    // Generate markdown content\n    const markdownContent = generateMarkdownFile(postData, id);\n    \n    console.log('Generated markdown content length:', markdownContent.length);\n    \n    // Save the file\n    const saved = await saveMarkdownFile(id, markdownContent);\n    \n    console.log('File saved:', saved);\n    \n    if (!saved) {\n      return new Response(JSON.stringify({\n        success: false,\n        error: 'Failed to update post file'\n      }), {\n        status: 500,\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n    }\n\n    return new Response(JSON.stringify({\n      success: true,\n      data: {\n        id: id,\n        title: postData.title,\n        slug: id,\n        content: postData.content,\n        excerpt: postData.description,\n        status: 'published',\n        category: postData.tags[0] || '',\n        tags: postData.tags,\n        featuredImage: postData.heroImage,\n        author: postData.author,\n        publishDate: postData.pubDate,\n        createdAt: postData.pubDate,\n        updatedAt: postData.updatedDate,\n        views: 0,\n        comments: 0,\n        seoScore: 85\n      }\n    }), {\n      status: 200,\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    });\n  } catch (error) {\n    console.error('Error updating post:', error);\n    return new Response(JSON.stringify({\n      success: false,\n      error: 'Failed to update post: ' + error.message\n    }), {\n      status: 500,\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    });\n  }\n};\n\nexport const DELETE: APIRoute = async ({ params }) => {\n  try {\n    const { id } = params;\n    \n    if (!id) {\n      return new Response(JSON.stringify({\n        success: false,\n        error: 'Post ID is required'\n      }), {\n        status: 400,\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n    }\n\n    const blogDir = path.join(process.cwd(), 'src', 'content', 'blog');\n    const filePath = path.join(blogDir, `${id}.md`);\n    \n    if (!fs.existsSync(filePath)) {\n      return new Response(JSON.stringify({\n        success: false,\n        error: 'Post not found'\n      }), {\n        status: 404,\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n    }\n\n    // Delete the file\n    fs.unlinkSync(filePath);\n    \n    return new Response(JSON.stringify({\n      success: true,\n      message: 'Post deleted successfully'\n    }), {\n      status: 200,\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    });\n  } catch (error) {\n    console.error('Error deleting post:', error);\n    return new Response(JSON.stringify({\n      success: false,\n      error: 'Failed to delete post'\n    }), {\n      status: 500,\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    });\n  }\n}; ",
        "language": "typescript"
      },
      {
        "path": "src/pages/api/posts/index.ts",
        "content": "import type { APIRoute } from 'astro';\nimport { generateMarkdownFile, saveMarkdownFile, generateSlug, isSlugUnique } from '../../../utils/markdown-generator';\nimport { getCollection } from 'astro:content';\nimport fs from 'fs';\nimport path from 'path';\n\n// Function to get posts from Astro Content Collections\nasync function getPostsFromContent() {\n  const posts = await getCollection('blog');\n  return posts.map((post: any) => ({\n    id: post.slug,\n    title: post.data.title,\n    slug: post.slug,\n    content: post.body,\n    excerpt: post.data.description,\n    status: 'published',\n    category: Array.isArray(post.data.tags) ? post.data.tags[0] || '' : '',\n    tags: Array.isArray(post.data.tags) ? post.data.tags : [],\n    featuredImage: post.data.heroImage || '',\n    author: post.data.author || 'Admin',\n    publishDate: post.data.pubDate ? new Date(post.data.pubDate) : new Date(),\n    createdAt: post.data.pubDate ? new Date(post.data.pubDate) : new Date(),\n    updatedAt: post.data.updatedDate ? new Date(post.data.updatedDate) : new Date(),\n    views: 0,\n    comments: 0,\n    seoScore: 85\n  })).sort((a: any, b: any) => b.publishDate.getTime() - a.publishDate.getTime());\n}\n\nexport const GET: APIRoute = async ({ url }) => {\n  try {\n    const searchParams = url.searchParams;\n    const filters = {\n      search: searchParams.get('search') || undefined,\n      status: searchParams.get('status') || undefined,\n      category: searchParams.get('category') || undefined,\n      date: searchParams.get('date') || undefined,\n      seo: searchParams.get('seo') || undefined,\n      page: parseInt(searchParams.get('page') || '1'),\n      limit: parseInt(searchParams.get('limit') || '25')\n    };\n\n    // Get posts from Astro Content Collections\n    const posts = await getPostsFromContent();\n\n    // Apply filters\n    let filteredPosts = posts;\n\n    if (filters.search) {\n      const searchTerm = filters.search.toLowerCase();\n      filteredPosts = filteredPosts.filter(post =>\n        post.title.toLowerCase().includes(searchTerm) ||\n        post.excerpt.toLowerCase().includes(searchTerm) ||\n        post.slug.toLowerCase().includes(searchTerm)\n      );\n    }\n\n    if (filters.category) {\n      filteredPosts = filteredPosts.filter(post => \n        post.tags.includes(filters.category!)\n      );\n    }\n\n    // Apply pagination\n    const start = (filters.page - 1) * filters.limit;\n    const end = start + filters.limit;\n    const paginatedPosts = filteredPosts.slice(start, end);\n\n    // Calculate stats\n    const stats = {\n      total: posts.length,\n      published: posts.length,\n      draft: 0,\n      scheduled: 0\n    };\n\n    return new Response(JSON.stringify({\n      success: true,\n      data: paginatedPosts,\n      stats: stats,\n      pagination: {\n        page: filters.page,\n        limit: filters.limit,\n        total: filteredPosts.length\n      }\n    }), {\n      status: 200,\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching posts:', error);\n    return new Response(JSON.stringify({\n      success: false,\n      error: 'Failed to fetch posts'\n    }), {\n      status: 500,\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    });\n  }\n};\n\nexport const POST: APIRoute = async ({ request }) => {\n  try {\n    console.log('POST request received');\n    \n    const body = await request.json();\n    console.log('POST request body:', body);\n    \n    // Validate required fields\n    if (!body.title || !body.content) {\n      console.log('Missing required fields');\n      return new Response(JSON.stringify({\n        success: false,\n        error: 'Title and content are required'\n      }), {\n        status: 400,\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n    }\n\n    // Generate slug\n    const slug = body.slug || generateSlug(body.title);\n    console.log('Generated slug:', slug);\n    \n    // Check if slug is unique\n    if (!isSlugUnique(slug)) {\n      console.log('Slug already exists:', slug);\n      return new Response(JSON.stringify({\n        success: false,\n        error: 'A post with this slug already exists'\n      }), {\n        status: 400,\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n    }\n\n    // Prepare post data\n    const postData = {\n      title: body.title,\n      description: body.excerpt || body.title,\n      content: body.content,\n      tags: body.tags || [],\n      author: body.author || 'Admin',\n      heroImage: body.featuredImage || '',\n      pubDate: body.publishDate ? new Date(body.publishDate) : new Date(),\n      updatedDate: new Date()\n    };\n\n    console.log('Prepared post data:', postData);\n\n    // Generate markdown content\n    const markdownContent = generateMarkdownFile(postData, slug);\n    console.log('Generated markdown content length:', markdownContent.length);\n    \n    // Save the file\n    const saved = await saveMarkdownFile(slug, markdownContent);\n    console.log('File saved:', saved);\n    \n    if (!saved) {\n      console.log('Failed to save file');\n      return new Response(JSON.stringify({\n        success: false,\n        error: 'Failed to save post file'\n      }), {\n        status: 500,\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n    }\n\n    console.log('Post created successfully');\n    return new Response(JSON.stringify({\n      success: true,\n      data: {\n        id: slug,\n        title: postData.title,\n        slug: slug,\n        content: postData.content,\n        excerpt: postData.description,\n        status: 'published',\n        category: postData.tags[0] || '',\n        tags: postData.tags,\n        featuredImage: postData.heroImage,\n        author: postData.author,\n        publishDate: postData.pubDate,\n        createdAt: postData.pubDate,\n        updatedAt: postData.updatedDate,\n        views: 0,\n        comments: 0,\n        seoScore: 85\n      }\n    }), {\n      status: 201,\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    });\n  } catch (error) {\n    console.error('Error creating post:', error);\n    return new Response(JSON.stringify({\n      success: false,\n      error: 'Failed to create post: ' + error.message\n    }), {\n      status: 500,\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    });\n  }\n}; ",
        "language": "typescript"
      },
      {
        "path": "src/types/index.ts",
        "content": "// User Types\nexport interface User {\n  id: string;\n  username: string;\n  email: string;\n  role: 'admin' | 'editor' | 'author';\n  avatar?: string;\n  createdAt: Date;\n  lastLogin?: Date;\n}\n\n// Post Types\nexport interface Post {\n  id: string;\n  title: string;\n  slug: string;\n  content: string;\n  excerpt: string;\n  status: 'draft' | 'published' | 'scheduled';\n  authorId: string;\n  author: User;\n  categories: Category[];\n  tags: Tag[];\n  featuredImage?: string;\n  seo: SEO;\n  publishedAt?: Date;\n  scheduledAt?: Date;\n  createdAt: Date;\n  updatedAt: Date;\n  viewCount: number;\n  commentCount: number;\n}\n\n// Category Types\nexport interface Category {\n  id: string;\n  name: string;\n  slug: string;\n  description?: string;\n  color: string;\n  postCount: number;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\n// Tag Types\nexport interface Tag {\n  id: string;\n  name: string;\n  slug: string;\n  postCount: number;\n  createdAt: Date;\n}\n\n// Comment Types\nexport interface Comment {\n  id: string;\n  postId: string;\n  authorName: string;\n  authorEmail: string;\n  content: string;\n  status: 'pending' | 'approved' | 'spam' | 'rejected';\n  createdAt: Date;\n  updatedAt: Date;\n  isSpam: boolean;\n}\n\n// SEO Types\nexport interface SEO {\n  metaTitle: string;\n  metaDescription: string;\n  canonicalUrl?: string;\n  ogImage?: string;\n  ogTitle?: string;\n  ogDescription?: string;\n  twitterCard?: string;\n  keywords?: string[];\n}\n\n// Site Settings Types\nexport interface SiteSettings {\n  id: string;\n  siteName: string;\n  siteDescription: string;\n  siteUrl: string;\n  language: string;\n  timezone: string;\n  postsPerPage: number;\n  allowComments: boolean;\n  moderateComments: boolean;\n  logo?: string;\n  favicon?: string;\n  primaryColor: string;\n  theme: 'light' | 'dark' | 'auto';\n  headerScripts: string;\n  footerScripts: string;\n  googleAnalytics: string;\n  facebookPixel: string;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\n// Social Media Types\nexport interface SocialMedia {\n  id: string;\n  platform: string;\n  url: string;\n  icon: string;\n  isActive: boolean;\n}\n\n// Newsletter Types\nexport interface NewsletterSubscriber {\n  id: string;\n  email: string;\n  isActive: boolean;\n  subscribedAt: Date;\n  unsubscribedAt?: Date;\n}\n\n// Contact Message Types\nexport interface ContactMessage {\n  id: string;\n  name: string;\n  email: string;\n  subject: string;\n  message: string;\n  status: 'unread' | 'read' | 'replied';\n  createdAt: Date;\n  repliedAt?: Date;\n}\n\n// Analytics Types\nexport interface Analytics {\n  totalPosts: number;\n  totalComments: number;\n  totalViews: number;\n  totalSubscribers: number;\n  topPosts: Post[];\n  recentComments: Comment[];\n  trafficSources: TrafficSource[];\n  pageViews: PageView[];\n}\n\nexport interface TrafficSource {\n  source: string;\n  count: number;\n  percentage: number;\n}\n\nexport interface PageView {\n  page: string;\n  views: number;\n  date: Date;\n}\n\n// Session Types\nexport interface Session {\n  id: string;\n  userId: string;\n  token: string;\n  expiresAt: Date;\n  createdAt: Date;\n  userAgent: string;\n  ipAddress: string;\n}\n\n// API Response Types\nexport interface ApiResponse<T> {\n  success: boolean;\n  data?: T;\n  message?: string;\n  error?: string;\n}\n\nexport interface PaginatedResponse<T> {\n  data: T[];\n  pagination: {\n    page: number;\n    limit: number;\n    total: number;\n    totalPages: number;\n  };\n}\n\n// Form Types\nexport interface LoginForm {\n  email: string;\n  password: string;\n  rememberMe: boolean;\n}\n\nexport interface PostForm {\n  title: string;\n  content: string;\n  excerpt: string;\n  status: 'draft' | 'published' | 'scheduled';\n  categories: string[];\n  tags: string[];\n  featuredImage?: string;\n  seo: SEO;\n  scheduledAt?: Date;\n}\n\nexport interface CategoryForm {\n  name: string;\n  description?: string;\n  color: string;\n}\n\nexport interface SettingsForm {\n  siteName: string;\n  siteDescription: string;\n  siteUrl: string;\n  language: string;\n  timezone: string;\n  postsPerPage: number;\n  allowComments: boolean;\n  moderateComments: boolean;\n  primaryColor: string;\n  theme: 'light' | 'dark' | 'auto';\n  headerScripts: string;\n  footerScripts: string;\n  googleAnalytics: string;\n  facebookPixel: string;\n} ",
        "language": "typescript"
      },
      {
        "path": "src/types/react.d.ts",
        "content": "declare module 'react' {\n  export = React;\n  export as namespace React;\n}\n\ndeclare namespace React {\n  interface HTMLAttributes<T> extends AriaAttributes, DOMAttributes<T> {\n    className?: string;\n    style?: CSSProperties;\n  }\n\n  interface CSSProperties {\n    [key: string]: string | number | undefined;\n  }\n\n  interface AriaAttributes {\n    [key: string]: string | number | boolean | undefined;\n  }\n\n  interface DOMAttributes<T> {\n    [key: string]: any;\n  }\n\n  interface FC<P = {}> {\n    (props: P): JSX.Element | null;\n  }\n}\n\ndeclare global {\n  namespace JSX {\n    interface Element {}\n  }\n} ",
        "language": "typescript"
      },
      {
        "path": "src/utils/analytics.ts",
        "content": "import { Analytics, TrafficSource, PageView, Post, Comment } from '../types';\n\n// Generate slug from title\nexport function generateSlug(title: string): string {\n  return title\n    .toLowerCase()\n    .replace(/[^\\w\\s-]/g, '') // Remove special characters\n    .replace(/\\s+/g, '-') // Replace spaces with hyphens\n    .replace(/-+/g, '-') // Replace multiple hyphens with single hyphen\n    .trim()\n    .replace(/^-+|-+$/g, ''); // Remove leading/trailing hyphens\n}\n\n// Analytics Manager\nexport class AnalyticsManager {\n  private static instance: AnalyticsManager;\n  private pageViews: PageView[] = [];\n  private trafficSources: Map<string, number> = new Map();\n\n  static getInstance(): AnalyticsManager {\n    if (!AnalyticsManager.instance) {\n      AnalyticsManager.instance = new AnalyticsManager();\n    }\n    return AnalyticsManager.instance;\n  }\n\n  // Track page view\n  trackPageView(page: string, source: string = 'direct'): void {\n    const pageView: PageView = {\n      page,\n      views: 1,\n      date: new Date()\n    };\n\n    this.pageViews.push(pageView);\n    this.trackTrafficSource(source);\n  }\n\n  // Track traffic source\n  private trackTrafficSource(source: string): void {\n    const currentCount = this.trafficSources.get(source) || 0;\n    this.trafficSources.set(source, currentCount + 1);\n  }\n\n  // Get analytics data\n  getAnalytics(posts: Post[], comments: Comment[]): Analytics {\n    const totalPosts = posts.length;\n    const totalComments = comments.length;\n    const totalViews = this.pageViews.reduce((sum, pv) => sum + pv.views, 0);\n    \n    // Get top posts (sorted by view count)\n    const topPosts = [...posts]\n      .sort((a, b) => b.viewCount - a.viewCount)\n      .slice(0, 5);\n\n    // Get recent comments\n    const recentComments = [...comments]\n      .sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime())\n      .slice(0, 10);\n\n    // Calculate traffic sources\n    const totalTraffic = Array.from(this.trafficSources.values()).reduce((sum, count) => sum + count, 0);\n    const trafficSources: TrafficSource[] = Array.from(this.trafficSources.entries()).map(([source, count]) => ({\n      source,\n      count,\n      percentage: totalTraffic > 0 ? (count / totalTraffic) * 100 : 0\n    }));\n\n    return {\n      totalPosts,\n      totalComments,\n      totalViews,\n      totalSubscribers: 0, // Will be implemented with newsletter\n      topPosts,\n      recentComments,\n      trafficSources,\n      pageViews: this.pageViews.slice(-30) // Last 30 page views\n    };\n  }\n\n  // Get page views for a specific page\n  getPageViews(page: string): number {\n    return this.pageViews\n      .filter(pv => pv.page === page)\n      .reduce((sum, pv) => sum + pv.views, 0);\n  }\n\n  // Get traffic sources\n  getTrafficSources(): TrafficSource[] {\n    const totalTraffic = Array.from(this.trafficSources.values()).reduce((sum, count) => sum + count, 0);\n    return Array.from(this.trafficSources.entries()).map(([source, count]) => ({\n      source,\n      count,\n      percentage: totalTraffic > 0 ? (count / totalTraffic) * 100 : 0\n    }));\n  }\n\n  // Clear old data (keep last 30 days)\n  cleanup(): void {\n    const thirtyDaysAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);\n    this.pageViews = this.pageViews.filter(pv => pv.date > thirtyDaysAgo);\n  }\n}\n\n// SEO Analyzer\nexport class SEOAnalyzer {\n  static analyzePost(title: string, content: string, metaDescription: string): {\n    score: number;\n    issues: string[];\n    suggestions: string[];\n  } {\n    const issues: string[] = [];\n    const suggestions: string[] = [];\n    let score = 100;\n\n    // Title analysis\n    if (title.length < 30) {\n      issues.push('Title is too short (should be 30-60 characters)');\n      score -= 10;\n    } else if (title.length > 60) {\n      issues.push('Title is too long (should be 30-60 characters)');\n      score -= 5;\n    }\n\n    // Meta description analysis\n    if (metaDescription.length < 120) {\n      issues.push('Meta description is too short (should be 120-160 characters)');\n      score -= 10;\n    } else if (metaDescription.length > 160) {\n      issues.push('Meta description is too long (should be 120-160 characters)');\n      score -= 5;\n    }\n\n    // Content analysis\n    if (content.length < 300) {\n      issues.push('Content is too short (should be at least 300 words)');\n      score -= 15;\n    }\n\n    // Keyword density analysis\n    const words = content.toLowerCase().split(/\\s+/);\n    const wordCount = words.length;\n    const titleWords = title.toLowerCase().split(/\\s+/);\n    \n    titleWords.forEach(word => {\n      if (word.length > 3) {\n        const count = words.filter(w => w.includes(word)).length;\n        const density = (count / wordCount) * 100;\n        if (density > 3) {\n          issues.push(`Keyword \"${word}\" density is too high (${density.toFixed(1)}%)`);\n          score -= 5;\n        }\n      }\n    });\n\n    // Suggestions\n    if (score < 80) {\n      suggestions.push('Consider improving your SEO score by addressing the issues above');\n    }\n    if (content.length < 500) {\n      suggestions.push('Add more relevant content to improve SEO');\n    }\n    if (!content.includes('h1') && !content.includes('h2')) {\n      suggestions.push('Add heading tags (H1, H2) to improve content structure');\n    }\n\n    return {\n      score: Math.max(0, score),\n      issues,\n      suggestions\n    };\n  }\n\n  static generateMetaDescription(content: string, maxLength: number = 160): string {\n    // Remove HTML tags and get plain text\n    const plainText = content.replace(/<[^>]*>/g, '');\n    \n    if (plainText.length <= maxLength) {\n      return plainText;\n    }\n\n    // Truncate at word boundary\n    const truncated = plainText.substring(0, maxLength);\n    const lastSpace = truncated.lastIndexOf(' ');\n    \n    return lastSpace > 0 ? truncated.substring(0, lastSpace) + '...' : truncated + '...';\n  }\n\n  static generateKeywords(content: string, maxKeywords: number = 10): string[] {\n    // Simple keyword extraction (in production, use more sophisticated algorithms)\n    const words = content.toLowerCase()\n      .replace(/[^\\w\\s]/g, '')\n      .split(/\\s+/)\n      .filter(word => word.length > 3);\n\n    const wordCount: Map<string, number> = new Map();\n    words.forEach(word => {\n      wordCount.set(word, (wordCount.get(word) || 0) + 1);\n    });\n\n    return Array.from(wordCount.entries())\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, maxKeywords)\n      .map(([word]) => word);\n  }\n}\n\n// Performance Monitor\nexport class PerformanceMonitor {\n  private static metrics: Map<string, number[]> = new Map();\n\n  static trackMetric(name: string, value: number): void {\n    if (!this.metrics.has(name)) {\n      this.metrics.set(name, []);\n    }\n    this.metrics.get(name)!.push(value);\n  }\n\n  static getAverageMetric(name: string): number {\n    const values = this.metrics.get(name);\n    if (!values || values.length === 0) return 0;\n    \n    return values.reduce((sum, val) => sum + val, 0) / values.length;\n  }\n\n  static getMetricStats(name: string): { min: number; max: number; avg: number; count: number } {\n    const values = this.metrics.get(name);\n    if (!values || values.length === 0) {\n      return { min: 0, max: 0, avg: 0, count: 0 };\n    }\n\n    return {\n      min: Math.min(...values),\n      max: Math.max(...values),\n      avg: values.reduce((sum, val) => sum + val, 0) / values.length,\n      count: values.length\n    };\n  }\n\n  static cleanup(): void {\n    // Keep only last 1000 measurements for each metric\n    this.metrics.forEach((values, name) => {\n      if (values.length > 1000) {\n        this.metrics.set(name, values.slice(-1000));\n      }\n    });\n  }\n} ",
        "language": "typescript"
      },
      {
        "path": "src/utils/auth.ts",
        "content": "import { Session, User } from '../types';\n\n// Session Management\nexport class SessionManager {\n  private static instance: SessionManager;\n  private sessions: Map<string, Session> = new Map();\n\n  static getInstance(): SessionManager {\n    if (!SessionManager.instance) {\n      SessionManager.instance = new SessionManager();\n    }\n    return SessionManager.instance;\n  }\n\n  createSession(userId: string, userAgent: string, ipAddress: string): Session {\n    const session: Session = {\n      id: this.generateSessionId(),\n      userId,\n      token: this.generateToken(),\n      expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000), // 24 hours\n      createdAt: new Date(),\n      userAgent,\n      ipAddress\n    };\n\n    this.sessions.set(session.token, session);\n    return session;\n  }\n\n  validateSession(token: string): Session | null {\n    const session = this.sessions.get(token);\n    if (!session || session.expiresAt < new Date()) {\n      this.sessions.delete(token);\n      return null;\n    }\n    return session;\n  }\n\n  removeSession(token: string): void {\n    this.sessions.delete(token);\n  }\n\n  private generateSessionId(): string {\n    return Math.random().toString(36).substring(2) + Date.now().toString(36);\n  }\n\n  private generateToken(): string {\n    return Math.random().toString(36).substring(2) + Date.now().toString(36);\n  }\n}\n\n// CSRF Protection\nexport class CSRFProtection {\n  private static tokens: Set<string> = new Set();\n\n  static generateToken(): string {\n    const token = Math.random().toString(36).substring(2) + Date.now().toString(36);\n    this.tokens.add(token);\n    return token;\n  }\n\n  static validateToken(token: string): boolean {\n    const isValid = this.tokens.has(token);\n    if (isValid) {\n      this.tokens.delete(token); // Use once\n    }\n    return isValid;\n  }\n\n  static cleanup(): void {\n    // Clean up old tokens periodically\n    this.tokens.clear();\n  }\n}\n\n// Rate Limiting\nexport class RateLimiter {\n  private static attempts: Map<string, { count: number; resetTime: number }> = new Map();\n\n  static checkLimit(identifier: string, maxAttempts: number = 5, windowMs: number = 15 * 60 * 1000): boolean {\n    const now = Date.now();\n    const attempt = this.attempts.get(identifier);\n\n    if (!attempt || now > attempt.resetTime) {\n      this.attempts.set(identifier, { count: 1, resetTime: now + windowMs });\n      return true;\n    }\n\n    if (attempt.count >= maxAttempts) {\n      return false;\n    }\n\n    attempt.count++;\n    return true;\n  }\n\n  static reset(identifier: string): void {\n    this.attempts.delete(identifier);\n  }\n}\n\n// Password Hashing (simplified for demo)\nexport class PasswordManager {\n  static async hashPassword(password: string): Promise<string> {\n    // In production, use bcrypt or similar\n    return btoa(password + 'salt');\n  }\n\n  static async verifyPassword(password: string, hash: string): Promise<boolean> {\n    const hashedPassword = await this.hashPassword(password);\n    return hash === hashedPassword;\n  }\n}\n\n// Authentication Middleware\nexport const requireAuth = (req: any, res: any, next: any) => {\n  const token = req.headers.authorization?.replace('Bearer ', '');\n  \n  if (!token) {\n    return res.status(401).json({ error: 'No token provided' });\n  }\n\n  const session = SessionManager.getInstance().validateSession(token);\n  if (!session) {\n    return res.status(401).json({ error: 'Invalid or expired token' });\n  }\n\n  req.user = session;\n  next();\n};\n\n// Admin Only Middleware\nexport const requireAdmin = (req: any, res: any, next: any) => {\n  if (!req.user || req.user.role !== 'admin') {\n    return res.status(403).json({ error: 'Admin access required' });\n  }\n  next();\n};\n\n// Utility Functions\nexport const sanitizeInput = (input: string): string => {\n  return input.replace(/[<>]/g, '');\n};\n\nexport const validateEmail = (email: string): boolean => {\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  return emailRegex.test(email);\n};\n\nexport const generateSlug = (title: string): string => {\n  return title\n    .toLowerCase()\n    .replace(/[^a-z0-9 -]/g, '')\n    .replace(/\\s+/g, '-')\n    .replace(/-+/g, '-')\n    .trim('-');\n}; ",
        "language": "typescript"
      },
      {
        "path": "src/utils/database.ts",
        "content": "import { \n  User, Post, Category, Tag, Comment, SiteSettings, \n  NewsletterSubscriber, ContactMessage, Session \n} from '../types';\n\n// In-memory database (in production, use a real database)\nexport class Database {\n  private static instance: Database;\n  \n  // Data stores\n  private users: Map<string, User> = new Map();\n  private posts: Map<string, Post> = new Map();\n  private categories: Map<string, Category> = new Map();\n  private tags: Map<string, Tag> = new Map();\n  private comments: Map<string, Comment> = new Map();\n  private settings: Map<string, SiteSettings> = new Map();\n  private subscribers: Map<string, NewsletterSubscriber> = new Map();\n  private contactMessages: Map<string, ContactMessage> = new Map();\n  private sessions: Map<string, Session> = new Map();\n\n  static getInstance(): Database {\n    if (!Database.instance) {\n      Database.instance = new Database();\n      Database.instance.initializeData();\n    }\n    return Database.instance;\n  }\n\n  private initializeData(): void {\n    // Initialize default admin user\n    const adminUser: User = {\n      id: '1',\n      username: 'admin',\n      email: 'admin@myblog.com',\n      role: 'admin',\n      createdAt: new Date(),\n      lastLogin: new Date()\n    };\n    this.users.set(adminUser.id, adminUser);\n\n    // Initialize default settings\n    const defaultSettings: SiteSettings = {\n      id: '1',\n      siteName: 'My Blog',\n      siteDescription: 'A personal blog where I share my programming and technology experiences',\n      siteUrl: 'http://localhost:4321',\n      language: 'en',\n      timezone: 'UTC',\n      postsPerPage: 10,\n      allowComments: true,\n      moderateComments: true,\n      primaryColor: '#0d6efd',\n      theme: 'light',\n      headerScripts: '',\n      footerScripts: '',\n      googleAnalytics: '',\n      facebookPixel: '',\n      createdAt: new Date(),\n      updatedAt: new Date()\n    };\n    this.settings.set(defaultSettings.id, defaultSettings);\n\n    // Initialize default categories\n    const defaultCategories: Category[] = [\n      {\n        id: '1',\n        name: 'Technology',\n        slug: 'technology',\n        description: 'Posts about technology and programming',\n        color: '#0d6efd',\n        postCount: 0,\n        createdAt: new Date(),\n        updatedAt: new Date()\n      },\n      {\n        id: '2',\n        name: 'Programming',\n        slug: 'programming',\n        description: 'Programming tutorials and tips',\n        color: '#198754',\n        postCount: 0,\n        createdAt: new Date(),\n        updatedAt: new Date()\n      }\n    ];\n\n    defaultCategories.forEach(category => {\n      this.categories.set(category.id, category);\n    });\n\n    // Initialize default tags\n    const defaultTags: Tag[] = [\n      { id: '1', name: 'Astro', slug: 'astro', postCount: 0, createdAt: new Date() },\n      { id: '2', name: 'SolidJS', slug: 'solidjs', postCount: 0, createdAt: new Date() },\n      { id: '3', name: 'Next.js', slug: 'nextjs', postCount: 0, createdAt: new Date() },\n      { id: '4', name: 'Tutorial', slug: 'tutorial', postCount: 0, createdAt: new Date() }\n    ];\n\n    defaultTags.forEach(tag => {\n      this.tags.set(tag.id, tag);\n    });\n  }\n\n  // User operations\n  async createUser(user: Omit<User, 'id' | 'createdAt'>): Promise<User> {\n    const newUser: User = {\n      ...user,\n      id: this.generateId(),\n      createdAt: new Date()\n    };\n    this.users.set(newUser.id, newUser);\n    return newUser;\n  }\n\n  async getUserById(id: string): Promise<User | null> {\n    return this.users.get(id) || null;\n  }\n\n  async getUserByEmail(email: string): Promise<User | null> {\n    return Array.from(this.users.values()).find(user => user.email === email) || null;\n  }\n\n  async updateUser(id: string, updates: Partial<User>): Promise<User | null> {\n    const user = this.users.get(id);\n    if (!user) return null;\n\n    const updatedUser = { ...user, ...updates, updatedAt: new Date() };\n    this.users.set(id, updatedUser);\n    return updatedUser;\n  }\n\n  async deleteUser(id: string): Promise<boolean> {\n    return this.users.delete(id);\n  }\n\n  // Post operations\n  async createPost(post: Omit<Post, 'id' | 'createdAt' | 'updatedAt' | 'viewCount' | 'commentCount'>): Promise<Post> {\n    const newPost: Post = {\n      ...post,\n      id: this.generateId(),\n      createdAt: new Date(),\n      updatedAt: new Date(),\n      viewCount: 0,\n      commentCount: 0\n    };\n    this.posts.set(newPost.id, newPost);\n    return newPost;\n  }\n\n  async getPostById(id: string): Promise<Post | null> {\n    return this.posts.get(id) || null;\n  }\n\n  async getPostBySlug(slug: string): Promise<Post | null> {\n    return Array.from(this.posts.values()).find(post => post.slug === slug) || null;\n  }\n\n  async getAllPosts(): Promise<Post[]> {\n    return Array.from(this.posts.values()).sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime());\n  }\n\n  async getPublishedPosts(): Promise<Post[]> {\n    return Array.from(this.posts.values())\n      .filter(post => post.status === 'published')\n      .sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime());\n  }\n\n  async updatePost(id: string, updates: Partial<Post>): Promise<Post | null> {\n    const post = this.posts.get(id);\n    if (!post) return null;\n\n    const updatedPost = { ...post, ...updates, updatedAt: new Date() };\n    this.posts.set(id, updatedPost);\n    return updatedPost;\n  }\n\n  async deletePost(id: string): Promise<boolean> {\n    return this.posts.delete(id);\n  }\n\n  async incrementViewCount(id: string): Promise<void> {\n    const post = this.posts.get(id);\n    if (post) {\n      post.viewCount++;\n      this.posts.set(id, post);\n    }\n  }\n\n  // Category operations\n  async createCategory(category: Omit<Category, 'id' | 'createdAt' | 'updatedAt' | 'postCount'>): Promise<Category> {\n    const newCategory: Category = {\n      ...category,\n      id: this.generateId(),\n      createdAt: new Date(),\n      updatedAt: new Date(),\n      postCount: 0\n    };\n    this.categories.set(newCategory.id, newCategory);\n    return newCategory;\n  }\n\n  async getAllCategories(): Promise<Category[]> {\n    return Array.from(this.categories.values());\n  }\n\n  async updateCategory(id: string, updates: Partial<Category>): Promise<Category | null> {\n    const category = this.categories.get(id);\n    if (!category) return null;\n\n    const updatedCategory = { ...category, ...updates, updatedAt: new Date() };\n    this.categories.set(id, updatedCategory);\n    return updatedCategory;\n  }\n\n  async deleteCategory(id: string): Promise<boolean> {\n    return this.categories.delete(id);\n  }\n\n  // Tag operations\n  async createTag(tag: Omit<Tag, 'id' | 'createdAt' | 'postCount'>): Promise<Tag> {\n    const newTag: Tag = {\n      ...tag,\n      id: this.generateId(),\n      createdAt: new Date(),\n      postCount: 0\n    };\n    this.tags.set(newTag.id, newTag);\n    return newTag;\n  }\n\n  async getAllTags(): Promise<Tag[]> {\n    return Array.from(this.tags.values());\n  }\n\n  async updateTag(id: string, updates: Partial<Tag>): Promise<Tag | null> {\n    const tag = this.tags.get(id);\n    if (!tag) return null;\n\n    const updatedTag = { ...tag, ...updates };\n    this.tags.set(id, updatedTag);\n    return updatedTag;\n  }\n\n  async deleteTag(id: string): Promise<boolean> {\n    return this.tags.delete(id);\n  }\n\n  // Comment operations\n  async createComment(comment: Omit<Comment, 'id' | 'createdAt' | 'updatedAt' | 'isSpam'>): Promise<Comment> {\n    const newComment: Comment = {\n      ...comment,\n      id: this.generateId(),\n      createdAt: new Date(),\n      updatedAt: new Date(),\n      isSpam: false\n    };\n    this.comments.set(newComment.id, newComment);\n    return newComment;\n  }\n\n  async getAllComments(): Promise<Comment[]> {\n    return Array.from(this.comments.values()).sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime());\n  }\n\n  async getCommentsByPostId(postId: string): Promise<Comment[]> {\n    return Array.from(this.comments.values())\n      .filter(comment => comment.postId === postId && comment.status === 'approved')\n      .sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime());\n  }\n\n  async updateComment(id: string, updates: Partial<Comment>): Promise<Comment | null> {\n    const comment = this.comments.get(id);\n    if (!comment) return null;\n\n    const updatedComment = { ...comment, ...updates, updatedAt: new Date() };\n    this.comments.set(id, updatedComment);\n    return updatedComment;\n  }\n\n  async deleteComment(id: string): Promise<boolean> {\n    return this.comments.delete(id);\n  }\n\n  // Settings operations\n  async getSettings(): Promise<SiteSettings | null> {\n    return Array.from(this.settings.values())[0] || null;\n  }\n\n  async updateSettings(updates: Partial<SiteSettings>): Promise<SiteSettings | null> {\n    const settings = Array.from(this.settings.values())[0];\n    if (!settings) return null;\n\n    const updatedSettings = { ...settings, ...updates, updatedAt: new Date() };\n    this.settings.set(settings.id, updatedSettings);\n    return updatedSettings;\n  }\n\n  // Newsletter operations\n  async createSubscriber(subscriber: Omit<NewsletterSubscriber, 'id' | 'subscribedAt'>): Promise<NewsletterSubscriber> {\n    const newSubscriber: NewsletterSubscriber = {\n      ...subscriber,\n      id: this.generateId(),\n      subscribedAt: new Date()\n    };\n    this.subscribers.set(newSubscriber.id, newSubscriber);\n    return newSubscriber;\n  }\n\n  async getAllSubscribers(): Promise<NewsletterSubscriber[]> {\n    return Array.from(this.subscribers.values()).filter(sub => sub.isActive);\n  }\n\n  async unsubscribe(email: string): Promise<boolean> {\n    const subscriber = Array.from(this.subscribers.values()).find(sub => sub.email === email);\n    if (subscriber) {\n      subscriber.isActive = false;\n      subscriber.unsubscribedAt = new Date();\n      this.subscribers.set(subscriber.id, subscriber);\n      return true;\n    }\n    return false;\n  }\n\n  // Contact message operations\n  async createContactMessage(message: Omit<ContactMessage, 'id' | 'createdAt'>): Promise<ContactMessage> {\n    const newMessage: ContactMessage = {\n      ...message,\n      id: this.generateId(),\n      createdAt: new Date()\n    };\n    this.contactMessages.set(newMessage.id, newMessage);\n    return newMessage;\n  }\n\n  async getAllContactMessages(): Promise<ContactMessage[]> {\n    return Array.from(this.contactMessages.values()).sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime());\n  }\n\n  async updateContactMessage(id: string, updates: Partial<ContactMessage>): Promise<ContactMessage | null> {\n    const message = this.contactMessages.get(id);\n    if (!message) return null;\n\n    const updatedMessage = { ...message, ...updates };\n    this.contactMessages.set(id, updatedMessage);\n    return updatedMessage;\n  }\n\n  async deleteContactMessage(id: string): Promise<boolean> {\n    return this.contactMessages.delete(id);\n  }\n\n  // Session operations\n  async createSession(session: Omit<Session, 'id'>): Promise<Session> {\n    const newSession: Session = {\n      ...session,\n      id: this.generateId()\n    };\n    this.sessions.set(newSession.id, newSession);\n    return newSession;\n  }\n\n  async getSessionByToken(token: string): Promise<Session | null> {\n    return Array.from(this.sessions.values()).find(session => session.token === token) || null;\n  }\n\n  async deleteSession(id: string): Promise<boolean> {\n    return this.sessions.delete(id);\n  }\n\n  async cleanupExpiredSessions(): Promise<void> {\n    const now = new Date();\n    for (const [id, session] of this.sessions.entries()) {\n      if (session.expiresAt < now) {\n        this.sessions.delete(id);\n      }\n    }\n  }\n\n  // Utility methods\n  private generateId(): string {\n    return Math.random().toString(36).substring(2) + Date.now().toString(36);\n  }\n\n  // Search functionality\n  async searchPosts(query: string): Promise<Post[]> {\n    const searchTerm = query.toLowerCase();\n    return Array.from(this.posts.values()).filter(post => \n      post.title.toLowerCase().includes(searchTerm) ||\n      post.content.toLowerCase().includes(searchTerm) ||\n      post.excerpt.toLowerCase().includes(searchTerm)\n    );\n  }\n\n  // Statistics\n  async getStatistics(): Promise<{\n    totalPosts: number;\n    totalComments: number;\n    totalSubscribers: number;\n    totalContactMessages: number;\n    publishedPosts: number;\n    draftPosts: number;\n    pendingComments: number;\n  }> {\n    const allPosts = Array.from(this.posts.values());\n    const allComments = Array.from(this.comments.values());\n    const allSubscribers = Array.from(this.subscribers.values());\n    const allContactMessages = Array.from(this.contactMessages.values());\n\n    return {\n      totalPosts: allPosts.length,\n      totalComments: allComments.length,\n      totalSubscribers: allSubscribers.filter(sub => sub.isActive).length,\n      totalContactMessages: allContactMessages.length,\n      publishedPosts: allPosts.filter(post => post.status === 'published').length,\n      draftPosts: allPosts.filter(post => post.status === 'draft').length,\n      pendingComments: allComments.filter(comment => comment.status === 'pending').length\n    };\n  }\n} ",
        "language": "typescript"
      },
      {
        "path": "src/utils/markdown-generator.ts",
        "content": "import fs from 'fs';\nimport path from 'path';\n\ninterface PostData {\n  id: number;\n  title: string;\n  description: string;\n  content: string;\n  pubDate: Date;\n  updatedDate?: Date;\n  tags: string[];\n  author: string;\n  heroImage?: string;\n  slug: string;\n}\n\nexport class MarkdownGenerator {\n  private contentDir = path.join(process.cwd(), 'src/content/blog');\n\n  /**\n   * تحويل مقالة من قاعدة البيانات إلى ملف Markdown\n   */\n  async generateMarkdownFile(post: PostData): Promise<void> {\n    const frontmatter = this.generateFrontmatter(post);\n    const markdownContent = `${frontmatter}\\n\\n${post.content}`;\n    \n    const filePath = path.join(this.contentDir, `${post.slug}.md`);\n    \n    try {\n      await fs.promises.writeFile(filePath, markdownContent, 'utf-8');\n      console.log(`✅ تم إنشاء ملف Markdown: ${post.slug}.md`);\n    } catch (error) {\n      console.error(`❌ خطأ في إنشاء الملف: ${error}`);\n    }\n  }\n\n  /**\n   * إنشاء Frontmatter للملف\n   */\n  private generateFrontmatter(post: PostData): string {\n    const frontmatter = {\n      title: post.title,\n      description: post.description,\n      pubDate: post.pubDate.toISOString().split('T')[0],\n      updatedDate: post.updatedDate ? post.updatedDate.toISOString().split('T')[0] : undefined,\n      tags: post.tags,\n      author: post.author,\n      heroImage: post.heroImage,\n      // إضافة بيانات SEO إضافية\n      seo: {\n        title: post.title,\n        description: post.description,\n        keywords: post.tags.join(', '),\n        ogImage: post.heroImage,\n        twitterCard: 'summary_large_image'\n      }\n    };\n\n    // تحويل إلى YAML\n    return `---\\n${this.objectToYaml(frontmatter)}---`;\n  }\n\n  /**\n   * تحويل Object إلى YAML\n   */\n  private objectToYaml(obj: any, indent = 0): string {\n    let yaml = '';\n    const spaces = '  '.repeat(indent);\n\n    for (const [key, value] of Object.entries(obj)) {\n      if (value === undefined || value === null) continue;\n\n      if (typeof value === 'object' && !Array.isArray(value)) {\n        yaml += `${spaces}${key}:\\n${this.objectToYaml(value, indent + 1)}`;\n      } else if (Array.isArray(value)) {\n        yaml += `${spaces}${key}:\\n`;\n        value.forEach(item => {\n          yaml += `${spaces}  - \"${item}\"\\n`;\n        });\n      } else if (typeof value === 'string') {\n        yaml += `${spaces}${key}: \"${value}\"\\n`;\n      } else {\n        yaml += `${spaces}${key}: ${value}\\n`;\n      }\n    }\n\n    return yaml;\n  }\n\n  /**\n   * حذف ملف Markdown\n   */\n  async deleteMarkdownFile(slug: string): Promise<void> {\n    const filePath = path.join(this.contentDir, `${slug}.md`);\n    \n    try {\n      await fs.promises.unlink(filePath);\n      console.log(`✅ تم حذف ملف Markdown: ${slug}.md`);\n    } catch (error) {\n      console.error(`❌ خطأ في حذف الملف: ${error}`);\n    }\n  }\n\n  /**\n   * تحديث ملف Markdown موجود\n   */\n  async updateMarkdownFile(post: PostData): Promise<void> {\n    await this.generateMarkdownFile(post);\n  }\n}\n\n// مثال على الاستخدام\nexport const markdownGenerator = new MarkdownGenerator(); ",
        "language": "typescript"
      },
      {
        "path": "src/utils/posts-api.ts",
        "content": "// أنواع البيانات للمقالات\nexport interface Post {\n  id: string;\n  title: string;\n  slug: string;\n  content: string;\n  excerpt: string;\n  status: 'draft' | 'published' | 'scheduled';\n  category: string;\n  tags: string[];\n  featuredImage?: string;\n  contentType: 'informational' | 'transactional' | 'navigational';\n  keywordType: 'short-tail' | 'long-tail';\n  metaTitle: string;\n  metaDescription: string;\n  keywords: string[];\n  focusKeyword: string;\n  ogTitle: string;\n  ogDescription: string;\n  ogImage?: string;\n  author: string;\n  publishDate?: Date;\n  createdAt: Date;\n  updatedAt: Date;\n  views: number;\n  comments: number;\n  seoScore: number;\n}\n\nexport interface PostFilters {\n  search?: string;\n  status?: string;\n  category?: string;\n  date?: string;\n  seo?: string;\n  page?: number;\n  limit?: number;\n}\n\nexport interface PostStats {\n  total: number;\n  published: number;\n  draft: number;\n  scheduled: number;\n}\n\n// محاكاة قاعدة البيانات\nlet posts: Post[] = [\n  {\n    id: '1',\n    title: 'دليل شامل للحمل في الأسبوع الخامس',\n    slug: 'pregnancy-week-5',\n    content: '<p>محتوى المقال هنا...</p>',\n    excerpt: 'دليل شامل يغطي جميع جوانب الحمل في الأسبوع الخامس',\n    status: 'published',\n    category: 'pregnancy',\n    tags: ['الحمل', 'الأسبوع الخامس', 'الصحة'],\n    featuredImage: '/images/pregnancy-week-5.jpg',\n    contentType: 'informational',\n    keywordType: 'long-tail',\n    metaTitle: 'دليل شامل للحمل في الأسبوع الخامس - كل ما تحتاجين معرفته',\n    metaDescription: 'دليل شامل يغطي جميع جوانب الحمل في الأسبوع الخامس، الأعراض، النصائح، والرعاية المطلوبة',\n    keywords: ['الحمل', 'الأسبوع الخامس', 'أعراض الحمل', 'رعاية الحامل'],\n    focusKeyword: 'الحمل الأسبوع الخامس',\n    ogTitle: 'دليل شامل للحمل في الأسبوع الخامس',\n    ogDescription: 'دليل شامل يغطي جميع جوانب الحمل في الأسبوع الخامس',\n    author: 'أحمد محمد',\n    publishDate: new Date('2024-01-15'),\n    createdAt: new Date('2024-01-10'),\n    updatedAt: new Date('2024-01-15'),\n    views: 1250,\n    comments: 23,\n    seoScore: 85\n  },\n  {\n    id: '2',\n    title: 'نصائح رعاية المولود الجديد',\n    slug: 'newborn-care-tips',\n    content: '<p>محتوى المقال هنا...</p>',\n    excerpt: 'نصائح مهمة لرعاية المولود الجديد في الأشهر الأولى',\n    status: 'published',\n    category: 'baby-care',\n    tags: ['رعاية الطفل', 'المولود الجديد', 'نصائح'],\n    featuredImage: '/images/newborn-care.jpg',\n    contentType: 'informational',\n    keywordType: 'long-tail',\n    metaTitle: 'نصائح رعاية المولود الجديد - دليل شامل للأمهات الجدد',\n    metaDescription: 'نصائح مهمة لرعاية المولود الجديد في الأشهر الأولى من حياته',\n    keywords: ['رعاية الطفل', 'المولود الجديد', 'نصائح الأمهات'],\n    focusKeyword: 'رعاية المولود الجديد',\n    ogTitle: 'نصائح رعاية المولود الجديد',\n    ogDescription: 'نصائح مهمة لرعاية المولود الجديد في الأشهر الأولى',\n    author: 'فاطمة علي',\n    publishDate: new Date('2024-01-14'),\n    createdAt: new Date('2024-01-08'),\n    updatedAt: new Date('2024-01-14'),\n    views: 980,\n    comments: 15,\n    seoScore: 65\n  },\n  {\n    id: '3',\n    title: 'تمارين آمنة للحوامل',\n    slug: 'safe-exercises-pregnant',\n    content: '<p>محتوى المقال هنا...</p>',\n    excerpt: 'تمارين آمنة ومفيدة للحوامل في جميع مراحل الحمل',\n    status: 'draft',\n    category: 'exercise',\n    tags: ['تمارين', 'الحمل', 'الصحة'],\n    featuredImage: '/images/pregnancy-exercise.jpg',\n    contentType: 'informational',\n    keywordType: 'long-tail',\n    metaTitle: 'تمارين آمنة للحوامل - دليل شامل للتمارين المفيدة',\n    metaDescription: 'تمارين آمنة ومفيدة للحوامل في جميع مراحل الحمل',\n    keywords: ['تمارين الحامل', 'تمارين آمنة', 'صحة الحامل'],\n    focusKeyword: 'تمارين آمنة للحوامل',\n    ogTitle: 'تمارين آمنة للحوامل',\n    ogDescription: 'تمارين آمنة ومفيدة للحوامل في جميع مراحل الحمل',\n    author: 'سارة أحمد',\n    createdAt: new Date('2024-01-13'),\n    updatedAt: new Date('2024-01-13'),\n    views: 0,\n    comments: 0,\n    seoScore: 45\n  }\n];\n\n// الحصول على جميع المقالات مع الفلاتر\nexport async function getPosts(filters: PostFilters = {}): Promise<Post[]> {\n  let filteredPosts = [...posts];\n\n  // تطبيق فلاتر البحث\n  if (filters.search) {\n    const searchTerm = filters.search.toLowerCase();\n    filteredPosts = filteredPosts.filter(post =>\n      post.title.toLowerCase().includes(searchTerm) ||\n      post.content.toLowerCase().includes(searchTerm) ||\n      post.excerpt.toLowerCase().includes(searchTerm)\n    );\n  }\n\n  // فلتر الحالة\n  if (filters.status) {\n    filteredPosts = filteredPosts.filter(post => post.status === filters.status);\n  }\n\n  // فلتر التصنيف\n  if (filters.category) {\n    filteredPosts = filteredPosts.filter(post => post.category === filters.category);\n  }\n\n  // فلتر التاريخ\n  if (filters.date) {\n    const now = new Date();\n    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n    \n    filteredPosts = filteredPosts.filter(post => {\n      if (!post.publishDate) return false;\n      \n      switch (filters.date) {\n        case 'today':\n          return post.publishDate >= today;\n        case 'week':\n          const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);\n          return post.publishDate >= weekAgo;\n        case 'month':\n          const monthAgo = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());\n          return post.publishDate >= monthAgo;\n        case 'year':\n          const yearAgo = new Date(today.getFullYear() - 1, today.getMonth(), today.getDate());\n          return post.publishDate >= yearAgo;\n        default:\n          return true;\n      }\n    });\n  }\n\n  // فلتر جودة SEO\n  if (filters.seo) {\n    filteredPosts = filteredPosts.filter(post => {\n      switch (filters.seo) {\n        case 'excellent':\n          return post.seoScore >= 80;\n        case 'good':\n          return post.seoScore >= 60 && post.seoScore < 80;\n        case 'poor':\n          return post.seoScore < 60;\n        default:\n          return true;\n      }\n    });\n  }\n\n  // الترتيب حسب تاريخ النشر (الأحدث أولاً)\n  filteredPosts.sort((a, b) => {\n    const dateA = a.publishDate || a.createdAt;\n    const dateB = b.publishDate || b.createdAt;\n    return dateB.getTime() - dateA.getTime();\n  });\n\n  // تطبيق الصفحات\n  if (filters.page && filters.limit) {\n    const start = (filters.page - 1) * filters.limit;\n    const end = start + filters.limit;\n    filteredPosts = filteredPosts.slice(start, end);\n  }\n\n  return filteredPosts;\n}\n\n// Get a single post by ID or slug\nexport async function getPost(idOrSlug: string): Promise<Post | null> {\n  // First try to find by ID\n  let post = posts.find(p => p.id === idOrSlug);\n  \n  // If not found by ID, try to find by slug\n  if (!post) {\n    post = posts.find(p => p.slug === idOrSlug);\n  }\n  \n  return post || null;\n}\n\n// إنشاء مقال جديد\nexport async function createPost(postData: Omit<Post, 'id' | 'createdAt' | 'updatedAt' | 'views' | 'comments'>): Promise<Post> {\n  const newPost: Post = {\n    ...postData,\n    id: Date.now().toString(),\n    createdAt: new Date(),\n    updatedAt: new Date(),\n    views: 0,\n    comments: 0\n  };\n\n  posts.push(newPost);\n  return newPost;\n}\n\n// تحديث مقال\nexport async function updatePost(id: string, postData: Partial<Post>): Promise<Post | null> {\n  const index = posts.findIndex(post => post.id === id);\n  if (index === -1) return null;\n\n  posts[index] = {\n    ...posts[index],\n    ...postData,\n    updatedAt: new Date()\n  };\n\n  return posts[index];\n}\n\n// حذف مقال\nexport async function deletePost(id: string): Promise<boolean> {\n  const index = posts.findIndex(post => post.id === id);\n  if (index === -1) return false;\n\n  posts.splice(index, 1);\n  return true;\n}\n\n// الحصول على إحصائيات المقالات\nexport async function getPostStats(): Promise<PostStats> {\n  const total = posts.length;\n  const published = posts.filter(post => post.status === 'published').length;\n  const draft = posts.filter(post => post.status === 'draft').length;\n  const scheduled = posts.filter(post => post.status === 'scheduled').length;\n\n  return { total, published, draft, scheduled };\n}\n\n// حساب درجة SEO للمقال\nexport function calculateSeoScore(post: Partial<Post>): number {\n  let score = 0;\n\n  // فحص العنوان (15 نقطة)\n  if (post.title && post.title.length >= 10 && post.title.length <= 60) {\n    score += 15;\n  }\n\n  // فحص الرابط (10 نقطة)\n  if (post.slug && post.slug.length > 0) {\n    score += 10;\n  }\n\n  // فحص المحتوى (20 نقطة)\n  if (post.content && post.content.length > 300) {\n    score += 20;\n  }\n\n  // فحص الملخص (10 نقطة)\n  if (post.excerpt && post.excerpt.length >= 50 && post.excerpt.length <= 160) {\n    score += 10;\n  }\n\n  // فحص عنوان الميتا (15 نقطة)\n  if (post.metaTitle && post.metaTitle.length >= 10 && post.metaTitle.length <= 60) {\n    score += 15;\n  }\n\n  // فحص وصف الميتا (15 نقطة)\n  if (post.metaDescription && post.metaDescription.length >= 50 && post.metaDescription.length <= 160) {\n    score += 15;\n  }\n\n  // فحص الكلمات المفتاحية (10 نقطة)\n  if (post.keywords && post.keywords.length > 0) {\n    score += 10;\n  }\n\n  // فحص التصنيف (5 نقطة)\n  if (post.category && post.category.length > 0) {\n    score += 5;\n  }\n\n  return Math.min(score, 100);\n}\n\n// توليد رابط تلقائي من العنوان\nexport function generateSlug(title: string): string {\n  return title\n    .toLowerCase()\n    .replace(/[^\\w\\s-]/g, '')\n    .replace(/[\\s_-]+/g, '-')\n    .replace(/^-+|-+$/g, '');\n}\n\n// التحقق من وجود الرابط\nexport function isSlugUnique(slug: string, excludeId?: string): boolean {\n  return !posts.some(post => post.slug === slug && post.id !== excludeId);\n}\n\n// الحصول على التصنيفات المتاحة\nexport function getCategories(): string[] {\n  return ['pregnancy', 'baby-care', 'health', 'nutrition', 'exercise', 'mental-health'];\n}\n\n// الحصول على الوسوم المتاحة\nexport function getTags(): string[] {\n  const allTags = posts.flatMap(post => post.tags);\n  return [...new Set(allTags)];\n} ",
        "language": "typescript"
      }
    ],
    "issueData": {}
  },
  "config": {
    "testTypes": [
      "unit",
      "integration",
      "security"
    ],
    "duration": "continuous",
    "autoFix": false,
    "marathonTaskId": "task-1768935302191"
  }
}